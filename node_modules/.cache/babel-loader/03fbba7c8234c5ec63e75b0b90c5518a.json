{"ast":null,"code":"import { Worksheets } from './worksheets';\nimport { Worksheet, FreezePane, MergeCell, MergeCells, HyperLink, Grouping } from './worksheet';\nimport { CellStyle, Font, Borders, CellXfs, Alignment, NumFmt, CellStyleXfs, CellStyles } from './cell-style';\nimport { Column } from './column';\nimport { Row, Rows } from './row';\nimport { Image } from './image';\nimport { Cell, Cells } from './cell';\nimport { ZipArchive, ZipArchiveItem } from '@syncfusion/ej2-compression';\nimport { CsvHelper } from './csv-helper';\nimport { Internationalization, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { BlobHelper } from './blob-helper';\nimport { AutoFilters } from './auto-filters';\n/**\n * Workbook class\n */\nvar Workbook = /** @class */function () {\n  /* tslint:disable:no-any */\n  function Workbook(json, saveType, culture, currencyString, separator) {\n    this.sharedStringCount = 0;\n    this.unitsProportions = [96 / 75.0, 96 / 300.0, 96, 96 / 25.4, 96 / 2.54, 1, 96 / 72.0, 96 / 72.0 / 12700];\n    /* tslint:disable:no-any */\n    this.hyperlinkStyle = {\n      fontColor: '#0000FF',\n      underline: true\n    };\n    if (culture !== undefined) {\n      this.culture = culture;\n    } else {\n      this.culture = 'en-US';\n    }\n    if (currencyString !== undefined) {\n      this.currency = currencyString;\n    } else {\n      this.currency = 'USD';\n    }\n    this.intl = new Internationalization(this.culture);\n    this.mSaveType = saveType;\n    if (saveType === 'xlsx') {\n      this.mArchive = new ZipArchive();\n      this.sharedString = [];\n      this.mFonts = [];\n      this.mBorders = [];\n      this.mStyles = [];\n      this.printTitles = new Map();\n      this.cellStyles = new Map();\n      this.mNumFmt = new Map();\n      this.mFills = new Map();\n      this.mStyles.push(new CellStyle());\n      this.mFonts.push(new Font());\n      /* tslint:disable */\n      this.cellStyles.set('Normal', new CellStyles());\n      /* tslint:enable */\n      this.mCellXfs = [];\n      this.mCellStyleXfs = [];\n      this.drawingCount = 0;\n      this.imageCount = 0;\n      if (json.styles !== null && json.styles !== undefined) {\n        /* tslint:disable-next-line:no-any */\n        this.globalStyles = new Map();\n        for (var i = 0; i < json.styles.length; i++) {\n          if (json.styles[i].name !== undefined) {\n            if (!this.cellStyles.has(json.styles[i].name)) {\n              var cellStyle = new CellStyle();\n              cellStyle.isGlobalStyle = true;\n              this.parserCellStyle(json.styles[i], cellStyle, 'none');\n              var cellStylesIn = new CellStyles();\n              cellStylesIn.name = cellStyle.name;\n              cellStylesIn.xfId = cellStyle.index - 1;\n              this.cellStyles.set(cellStylesIn.name, cellStylesIn);\n              /* tslint:disable-next-line:no-any */\n              var tFormat = {};\n              if (json.styles[i].numberFormat !== undefined) {\n                tFormat.format = json.styles[i].numberFormat;\n              }\n              if (json.styles[i].type !== undefined) {\n                tFormat.type = json.styles[i].type;\n              } else {\n                tFormat.type = 'datetime';\n              }\n              if (tFormat.format !== undefined) {\n                this.globalStyles.set(json.styles[i].name, tFormat);\n              }\n            } else {\n              throw Error('Style name ' + json.styles[i].name + ' is already existed');\n            }\n          }\n        }\n      }\n      // Parses Worksheets data to DOM.        \n      if (json.worksheets !== null && json.worksheets !== undefined) {\n        this.parserWorksheets(json.worksheets);\n      } else {\n        throw Error('Worksheet is expected.');\n      }\n      // Parses the BuiltInProperties data to DOM.        \n      if (json.builtInProperties !== null && json.builtInProperties !== undefined) {\n        this.builtInProperties = new BuiltInProperties();\n        this.parserBuiltInProperties(json.builtInProperties, this.builtInProperties);\n      }\n    } else {\n      this.csvHelper = new CsvHelper(json, separator);\n    }\n  }\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserBuiltInProperties = function (jsonBuiltInProperties, builtInProperties) {\n    //Author\n    if (jsonBuiltInProperties.author !== null && jsonBuiltInProperties.author !== undefined) {\n      builtInProperties.author = jsonBuiltInProperties.author;\n    }\n    //Comments\n    if (jsonBuiltInProperties.comments !== null && jsonBuiltInProperties.comments !== undefined) {\n      builtInProperties.comments = jsonBuiltInProperties.comments;\n    }\n    //Category\n    if (jsonBuiltInProperties.category !== null && jsonBuiltInProperties.category !== undefined) {\n      builtInProperties.category = jsonBuiltInProperties.category;\n    }\n    //Company\n    if (jsonBuiltInProperties.company !== null && jsonBuiltInProperties.company !== undefined) {\n      builtInProperties.company = jsonBuiltInProperties.company;\n    }\n    //Manager\n    if (jsonBuiltInProperties.manager !== null && jsonBuiltInProperties.manager !== undefined) {\n      builtInProperties.manager = jsonBuiltInProperties.manager;\n    }\n    //Subject\n    if (jsonBuiltInProperties.subject !== null && jsonBuiltInProperties.subject !== undefined) {\n      builtInProperties.subject = jsonBuiltInProperties.subject;\n    }\n    //Title\n    if (jsonBuiltInProperties.title !== null && jsonBuiltInProperties.title !== undefined) {\n      builtInProperties.title = jsonBuiltInProperties.title;\n    }\n    //Creation date\n    if (jsonBuiltInProperties.createdDate !== null && jsonBuiltInProperties.createdDate !== undefined) {\n      builtInProperties.createdDate = jsonBuiltInProperties.createdDate;\n    }\n    //Modified date\n    if (jsonBuiltInProperties.modifiedDate !== null && jsonBuiltInProperties.modifiedDate !== undefined) {\n      builtInProperties.modifiedDate = jsonBuiltInProperties.modifiedDate;\n    }\n    //Tags\n    if (jsonBuiltInProperties.tags !== null && jsonBuiltInProperties.tags !== undefined) {\n      builtInProperties.tags = jsonBuiltInProperties.tags;\n    }\n    //Status\n    if (jsonBuiltInProperties.status !== null && jsonBuiltInProperties.status !== undefined) {\n      builtInProperties.status = jsonBuiltInProperties.status;\n    }\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserWorksheets = function (json) {\n    this.worksheets = new Worksheets();\n    var length = json.length;\n    for (var i = 0; i < length; i++) {\n      var jsonSheet = json[i];\n      var sheet = new Worksheet();\n      this.mergeCells = new MergeCells();\n      this.mergedCellsStyle = new Map();\n      this.mHyperLinks = [];\n      //Name\n      if (jsonSheet.name !== null && jsonSheet.name !== undefined) {\n        sheet.name = jsonSheet.name;\n      } else {\n        sheet.name = 'Sheet' + (i + 1).toString();\n      }\n      if (jsonSheet.enableRtl !== null && jsonSheet.enableRtl !== undefined) {\n        sheet.enableRtl = jsonSheet.enableRtl;\n      }\n      sheet.index = i + 1;\n      //Columns\n      if (jsonSheet.columns !== null && jsonSheet.columns !== undefined) {\n        this.parserColumns(jsonSheet.columns, sheet);\n      }\n      //Rows\n      if (jsonSheet.rows !== null && jsonSheet.rows !== undefined) {\n        this.parserRows(jsonSheet.rows, sheet);\n      }\n      //showGridLines\n      if (jsonSheet.showGridLines !== null && jsonSheet.showGridLines !== undefined) {\n        sheet.showGridLines = jsonSheet.showGridLines;\n      }\n      //FreezePanes\n      if (jsonSheet.freeze !== null && jsonSheet.freeze !== undefined) {\n        this.parserFreezePanes(jsonSheet.freeze, sheet);\n      }\n      //Print Title\n      if (jsonSheet.printTitle !== null && jsonSheet.printTitle !== undefined) {\n        this.parserPrintTitle(jsonSheet.printTitle, sheet);\n      }\n      if (jsonSheet.pageSetup !== undefined) {\n        if (jsonSheet.pageSetup.isSummaryRowBelow !== undefined) {\n          sheet.isSummaryRowBelow = jsonSheet.pageSetup.isSummaryRowBelow;\n        }\n      }\n      if (jsonSheet.images !== undefined) {\n        this.parserImages(jsonSheet.images, sheet);\n      }\n      if (jsonSheet.autoFilters !== null && jsonSheet.autoFilters !== undefined) {\n        this.parseFilters(jsonSheet.autoFilters, sheet);\n      }\n      sheet.index = i + 1;\n      sheet.mergeCells = this.mergeCells;\n      sheet.hyperLinks = this.mHyperLinks;\n      this.worksheets.push(sheet);\n    }\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.mergeOptions = function (fromJson, toJson) {\n    /* tslint:disable:no-any */\n    var result = {};\n    this.applyProperties(fromJson, result);\n    this.applyProperties(toJson, result);\n    return result;\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.applyProperties = function (sourceJson, destJson) {\n    var keys = Object.keys(sourceJson);\n    for (var index = 0; index < keys.length; index++) {\n      if (keys[index] !== 'name') {\n        destJson[keys[index]] = sourceJson[keys[index]];\n      }\n    }\n  };\n  Workbook.prototype.getCellName = function (row, column) {\n    return this.getColumnName(column) + row.toString();\n  };\n  Workbook.prototype.getColumnName = function (col) {\n    col--;\n    var strColumnName = '';\n    do {\n      var iCurrentDigit = col % 26;\n      col = col / 26 - 1;\n      strColumnName = String.fromCharCode(65 + iCurrentDigit) + strColumnName;\n    } while (col >= 0);\n    return strColumnName;\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserPrintTitle = function (json, sheet) {\n    var printTitleName = '';\n    var titleRowName;\n    if (json.fromRow !== null && json.fromRow !== undefined) {\n      var fromRow = json.fromRow;\n      var toRow = void 0;\n      if (json.toRow !== null && json.toRow !== undefined) {\n        toRow = json.toRow;\n      } else {\n        toRow = json.fromRow;\n      }\n      titleRowName = '$' + fromRow + ':$' + toRow;\n    }\n    var titleColName;\n    if (json.fromColumn !== null && json.fromColumn !== undefined) {\n      var fromColumn = json.fromColumn;\n      var toColumn = void 0;\n      if (json.toColumn !== null && json.toColumn !== undefined) {\n        toColumn = json.toColumn;\n      } else {\n        toColumn = json.fromColumn;\n      }\n      titleColName = '$' + this.getColumnName(fromColumn) + ':$' + this.getColumnName(toColumn);\n    }\n    if (titleRowName !== undefined) {\n      printTitleName += sheet.name + '!' + titleRowName;\n    }\n    if (titleColName !== undefined && titleRowName !== undefined) {\n      printTitleName += ',' + (sheet.name + '!' + titleColName);\n    } else if (titleColName !== undefined) {\n      printTitleName += sheet.name + '!' + titleColName;\n    }\n    if (printTitleName !== '') {\n      this.printTitles.set(sheet.index - 1, printTitleName);\n    }\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserFreezePanes = function (json, sheet) {\n    sheet.freezePanes = new FreezePane();\n    if (json.row !== null && json.row !== undefined) {\n      sheet.freezePanes.row = json.row;\n    } else {\n      sheet.freezePanes.row = 0;\n    }\n    if (json.column !== null && json.column !== undefined) {\n      sheet.freezePanes.column = json.column;\n    } else {\n      sheet.freezePanes.column = 0;\n    }\n    sheet.freezePanes.leftCell = this.getCellName(sheet.freezePanes.row + 1, sheet.freezePanes.column + 1);\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserColumns = function (json, sheet) {\n    var columnsLength = json.length;\n    sheet.columns = [];\n    for (var column = 0; column < columnsLength; column++) {\n      var col = new Column();\n      if (json[column].index !== null && json[column].index !== undefined) {\n        col.index = json[column].index;\n      } else {\n        throw Error('Column index is missing.');\n      }\n      if (json[column].width !== null && json[column].width !== undefined) {\n        col.width = json[column].width;\n      }\n      sheet.columns.push(col);\n    }\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserRows = function (json, sheet) {\n    var rowsLength = json.length;\n    sheet.rows = new Rows();\n    var rowId = 0;\n    for (var r = 0; r < rowsLength; r++) {\n      var row = this.parserRow(json[r], rowId);\n      rowId = row.index;\n      sheet.rows.add(row);\n    }\n    this.insertMergedCellsStyle(sheet);\n  };\n  Workbook.prototype.insertMergedCellsStyle = function (sheet) {\n    var _this = this;\n    if (this.mergeCells.length > 0) {\n      this.mergedCellsStyle.forEach(function (value, key) {\n        var row = sheet.rows.filter(function (item) {\n          return item.index === value.y;\n        })[0];\n        if (!isNullOrUndefined(row)) {\n          var cell = row.cells.filter(function (item) {\n            return item.index === value.x;\n          })[0];\n          if (!isNullOrUndefined(cell)) {\n            cell.styleIndex = value.styleIndex;\n          } else {\n            var cells = row.cells.filter(function (item) {\n              return item.index <= value.x;\n            });\n            var insertIndex = 0;\n            if (cells.length > 0) {\n              insertIndex = row.cells.indexOf(cells[cells.length - 1]) + 1;\n            }\n            row.cells.splice(insertIndex, 0, _this.createCell(value, key));\n          }\n        } else {\n          var rows = sheet.rows.filter(function (item) {\n            return item.index <= value.y;\n          });\n          var rowToInsert = new Row();\n          rowToInsert.index = value.y;\n          rowToInsert.cells = new Cells();\n          rowToInsert.cells.add(_this.createCell(value, key));\n          var insertIndex = 0;\n          if (rows.length > 0) {\n            insertIndex = sheet.rows.indexOf(rows[rows.length - 1]) + 1;\n          }\n          sheet.rows.splice(insertIndex, 0, rowToInsert);\n        }\n      });\n    }\n  };\n  Workbook.prototype.createCell = function (value, key) {\n    var cellToInsert = new Cell();\n    cellToInsert.refName = key;\n    cellToInsert.index = value.x;\n    cellToInsert.cellStyle = new CellStyle();\n    cellToInsert.styleIndex = value.styleIndex;\n    return cellToInsert;\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserRow = function (json, rowIndex) {\n    var row = new Row();\n    //Row Height\n    if (json.height !== null && json.height !== undefined) {\n      row.height = json.height;\n    }\n    //Row index\n    if (json.index !== null && json.index !== undefined) {\n      row.index = json.index;\n    } else {\n      throw Error('Row index is missing.');\n    }\n    if (json.grouping !== null && json.grouping !== undefined) {\n      this.parseGrouping(json.grouping, row);\n    }\n    this.parseCells(json.cells, row);\n    return row;\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parseGrouping = function (json, row) {\n    row.grouping = new Grouping();\n    if (json.outlineLevel !== undefined) {\n      row.grouping.outlineLevel = json.outlineLevel;\n    }\n    if (json.isCollapsed !== undefined) {\n      row.grouping.isCollapsed = json.isCollapsed;\n    }\n    if (json.isHidden !== undefined) {\n      row.grouping.isHidden = json.isHidden;\n    }\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parseCells = function (json, row) {\n    row.cells = new Cells();\n    var cellsLength = json !== undefined ? json.length : 0;\n    var spanMin = 1;\n    var spanMax = 1;\n    var curCellIndex = 0;\n    for (var cellId = 0; cellId < cellsLength; cellId++) {\n      /* tslint:disable:no-any */\n      var jsonCell = json[cellId];\n      var cell = new Cell();\n      //cell index\n      if (jsonCell.index !== null && jsonCell.index !== undefined) {\n        cell.index = jsonCell.index;\n      } else {\n        throw Error('Cell index is missing.');\n      }\n      if (cell.index < spanMin) {\n        spanMin = cell.index;\n      } else if (cell.index > spanMax) {\n        spanMax = cell.index;\n      }\n      //Update the Cell name\n      cell.refName = this.getCellName(row.index, cell.index);\n      //Row span\n      if (jsonCell.rowSpan !== null && jsonCell.rowSpan !== undefined) {\n        cell.rowSpan = jsonCell.rowSpan - 1;\n      } else {\n        cell.rowSpan = 0;\n      }\n      //Column span\n      if (jsonCell.colSpan !== null && jsonCell.colSpan !== undefined) {\n        cell.colSpan = jsonCell.colSpan - 1;\n      } else {\n        cell.colSpan = 0;\n      }\n      //Hyperlink\n      if (jsonCell.hyperlink !== null && jsonCell.hyperlink !== undefined) {\n        var hyperLink = new HyperLink();\n        if (jsonCell.hyperlink.target !== undefined) {\n          hyperLink.target = jsonCell.hyperlink.target;\n          if (jsonCell.hyperlink.displayText !== undefined) {\n            cell.value = jsonCell.hyperlink.displayText;\n          } else {\n            cell.value = jsonCell.hyperlink.target;\n          }\n          cell.type = this.getCellValueType(cell.value);\n          hyperLink.ref = cell.refName;\n          hyperLink.rId = this.mHyperLinks.length + 1;\n          this.mHyperLinks.push(hyperLink);\n          cell.cellStyle = new CellStyle();\n          /* tslint:disable-next-line:max-line-length */\n          this.parserCellStyle(jsonCell.style !== undefined ? this.mergeOptions(jsonCell.style, this.hyperlinkStyle) : this.hyperlinkStyle, cell.cellStyle, 'string');\n          cell.styleIndex = cell.cellStyle.index;\n        }\n      }\n      // formulas\n      if (jsonCell.formula !== null && jsonCell.formula !== undefined) {\n        cell.formula = jsonCell.formula;\n        cell.type = 'formula';\n      }\n      //Cell value\n      if (jsonCell.value !== null && jsonCell.value !== undefined) {\n        if (cell.formula !== undefined) {\n          cell.value = 0;\n        } else {\n          cell.value = jsonCell.value;\n          cell.type = this.getCellValueType(cell.value);\n        }\n      }\n      if (jsonCell.style !== null && jsonCell.style !== undefined && cell.styleIndex === undefined) {\n        cell.cellStyle = new CellStyle();\n        if (cell.value instanceof Date) {\n          this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type, 14);\n        } else {\n          this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type);\n        }\n        cell.styleIndex = cell.cellStyle.index;\n      } else if (cell.value instanceof Date) {\n        cell.cellStyle = new CellStyle();\n        this.parserCellStyle({}, cell.cellStyle, cell.type, 14);\n        cell.styleIndex = cell.cellStyle.index;\n      }\n      this.parseCellType(cell);\n      this.mergeCells = this.processMergeCells(cell, row.index, this.mergeCells);\n      row.cells.add(cell);\n      curCellIndex = cell.index + 1;\n    }\n    row.spans = spanMin + ':' + spanMax;\n  };\n  Workbook.prototype.GetColors = function () {\n    var colors;\n    colors = new Map();\n    /* tslint:disable */\n    colors.set('WHITE', 'FFFFFFFF');\n    /* tslint:disable */\n    colors.set('SILVER', 'FFC0C0C0');\n    /* tslint:disable */\n    colors.set('GRAY', 'FF808080');\n    /* tslint:disable */\n    colors.set('BLACK', 'FF000000');\n    /* tslint:disable */\n    colors.set('RED', 'FFFF0000');\n    /* tslint:disable */\n    colors.set('MAROON', 'FF800000');\n    /* tslint:disable */\n    colors.set('YELLOW', 'FFFFFF00');\n    /* tslint:disable */\n    colors.set('OLIVE', 'FF808000');\n    /* tslint:disable */\n    colors.set('LIME', 'FF00FF00');\n    /* tslint:disable */\n    colors.set('GREEN', 'FF008000');\n    /* tslint:disable */\n    colors.set('AQUA', 'FF00FFFF');\n    /* tslint:disable */\n    colors.set('TEAL', 'FF008080');\n    /* tslint:disable */\n    colors.set('BLUE', 'FF0000FF');\n    /* tslint:disable */\n    colors.set('NAVY', 'FF000080');\n    /* tslint:disable */\n    colors.set('FUCHSIA', 'FFFF00FF');\n    /* tslint:disable */\n    colors.set('PURPLE', 'FF800080');\n    return colors;\n  };\n  Workbook.prototype.processColor = function (colorVal) {\n    if (colorVal.indexOf('#') === 0) {\n      return colorVal.replace('#', 'FF');\n    }\n    colorVal = colorVal.toUpperCase();\n    this.rgbColors = this.GetColors();\n    if (this.rgbColors.has(colorVal)) {\n      colorVal = this.rgbColors.get(colorVal);\n    } else {\n      colorVal = 'FF000000';\n    }\n    return colorVal;\n  };\n  Workbook.prototype.processCellValue = function (value, cell) {\n    var cellValue = value;\n    if (value.indexOf(\"<font\") !== -1 || value.indexOf(\"<a\") !== -1 || value.indexOf(\"<b>\") !== -1 || value.indexOf(\"<i>\") !== -1 || value.indexOf(\"<u>\") !== -1) {\n      var processedVal = '';\n      var startindex = value.indexOf('<', 0);\n      var endIndex = value.indexOf('>', startindex + 1);\n      if (startindex >= 0 && endIndex >= 0) {\n        if (startindex !== 0) {\n          processedVal += '<r><t xml:space=\"preserve\">' + this.processString(value.substring(0, startindex)) + '</t></r>';\n        }\n        while (startindex >= 0 && endIndex >= 0) {\n          endIndex = value.indexOf('>', startindex + 1);\n          if (endIndex >= 0) {\n            var subString = value.substring(startindex + 1, endIndex);\n            startindex = value.indexOf('<', endIndex + 1);\n            if (startindex < 0) {\n              startindex = cellValue.length;\n            }\n            var text = cellValue.substring(endIndex + 1, startindex);\n            if (text.length !== 0) {\n              var subSplit = subString.split(' ');\n              if (subSplit.length > 0) {\n                processedVal += '<r><rPr>';\n              }\n              if (subSplit.length > 1) {\n                for (var _i = 0, subSplit_1 = subSplit; _i < subSplit_1.length; _i++) {\n                  var element = subSplit_1[_i];\n                  var start = element.trim().substring(0, 5);\n                  switch (start) {\n                    case 'size=':\n                      processedVal += '<sz val=\"' + element.substring(6, element.length - 1) + '\"/>';\n                      break;\n                    case 'face=':\n                      processedVal += '<rFont val=\"' + element.substring(6, element.length - 1) + '\"/>';\n                      break;\n                    case 'color':\n                      processedVal += '<color rgb=\"' + this.processColor(element.substring(7, element.length - 1)) + '\"/>';\n                      break;\n                    case 'href=':\n                      var hyperLink = new HyperLink();\n                      hyperLink.target = element.substring(6, element.length - 1).trim();\n                      hyperLink.ref = cell.refName;\n                      hyperLink.rId = this.mHyperLinks.length + 1;\n                      this.mHyperLinks.push(hyperLink);\n                      processedVal += '<color rgb=\"FF0000FF\"/><u/><b/>';\n                      break;\n                  }\n                }\n              } else if (subSplit.length === 1) {\n                var style = subSplit[0].trim();\n                switch (style) {\n                  case 'b':\n                    processedVal += '<b/>';\n                    break;\n                  case 'i':\n                    processedVal += '<i/>';\n                    break;\n                  case 'u':\n                    processedVal += '<u/>';\n                    break;\n                }\n              }\n              processedVal += '</rPr><t xml:space=\"preserve\">' + this.processString(text) + '</t></r>';\n            }\n          }\n        }\n        if (processedVal === '') {\n          return cellValue;\n        }\n        return processedVal;\n      } else {\n        return cellValue;\n      }\n    } else {\n      return cellValue;\n    }\n  };\n  Workbook.prototype.applyGlobalStyle = function (json, cellStyle) {\n    var index = 0;\n    if (this.cellStyles.has(json.name)) {\n      cellStyle.index = this.mStyles.filter(function (a) {\n        return a.name === json.name;\n      })[0].index;\n      cellStyle.name = json.name;\n    }\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserCellStyle = function (json, cellStyle, cellType, defStyleIndex) {\n    //name\n    if (json.name !== null && json.name !== undefined) {\n      if (cellStyle.isGlobalStyle) {\n        cellStyle.name = json.name;\n      } else {\n        this.applyGlobalStyle(json, cellStyle);\n        return;\n      }\n    }\n    //background color\n    if (json.backColor !== null && json.backColor !== undefined) {\n      cellStyle.backColor = json.backColor;\n    }\n    //borders\n    //leftBorder\n    cellStyle.borders = new Borders();\n    //AllBorder\n    if (json.borders !== null && json.borders !== undefined) {\n      this.parserBorder(json.borders, cellStyle.borders.all);\n    }\n    //leftborder\n    if (json.leftBorder !== null && json.leftBorder !== undefined) {\n      this.parserBorder(json.leftBorder, cellStyle.borders.left);\n    }\n    //rightBorder\n    if (json.rightBorder !== null && json.rightBorder !== undefined) {\n      this.parserBorder(json.rightBorder, cellStyle.borders.right);\n    }\n    //topBorder\n    if (json.topBorder !== null && json.topBorder !== undefined) {\n      this.parserBorder(json.topBorder, cellStyle.borders.top);\n    }\n    //bottomBorder\n    if (json.bottomBorder !== null && json.bottomBorder !== undefined) {\n      this.parserBorder(json.bottomBorder, cellStyle.borders.bottom);\n    }\n    //fontName\n    if (json.fontName !== null && json.fontName !== undefined) {\n      cellStyle.fontName = json.fontName;\n    }\n    //fontSize\n    if (json.fontSize !== null && json.fontSize !== undefined) {\n      cellStyle.fontSize = json.fontSize;\n    }\n    //fontColor\n    if (json.fontColor !== null && json.fontColor !== undefined) {\n      cellStyle.fontColor = json.fontColor;\n    }\n    //italic\n    if (json.italic !== null && json.italic !== undefined) {\n      cellStyle.italic = json.italic;\n    }\n    //bold\n    if (json.bold !== null && json.bold !== undefined) {\n      cellStyle.bold = json.bold;\n    }\n    //hAlign\n    if (json.hAlign !== null && json.hAlign !== undefined) {\n      cellStyle.hAlign = json.hAlign.toLowerCase();\n    }\n    //indent\n    if (json.indent !== null && json.indent !== undefined) {\n      cellStyle.indent = json.indent;\n      if (!(cellStyle.hAlign === 'left' || cellStyle.hAlign === 'right')) {\n        cellStyle.hAlign = 'left';\n      }\n    }\n    if (json.rotation !== null && json.rotation !== undefined) {\n      cellStyle.rotation = json.rotation;\n    }\n    //vAlign\n    if (json.vAlign !== null && json.vAlign !== undefined) {\n      cellStyle.vAlign = json.vAlign.toLowerCase();\n    }\n    //underline\n    if (json.underline !== null && json.underline !== undefined) {\n      cellStyle.underline = json.underline;\n    }\n    //strikeThrough\n    if (json.strikeThrough !== null && json.strikeThrough !== undefined) {\n      cellStyle.strikeThrough = json.strikeThrough;\n    }\n    //wrapText\n    if (json.wrapText !== null && json.wrapText !== undefined) {\n      cellStyle.wrapText = json.wrapText;\n    }\n    //numberFormat\n    if (json.numberFormat !== null && json.numberFormat !== undefined) {\n      if (json.type !== null && json.type !== undefined) {\n        cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, json.type);\n      } else {\n        cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, cellType);\n      }\n    } else if (defStyleIndex !== undefined) {\n      cellStyle.numFmtId = 14;\n      cellStyle.numberFormat = 'GENERAL';\n    } else {\n      cellStyle.numberFormat = 'GENERAL';\n    }\n    cellStyle.index = this.processCellStyle(cellStyle);\n  };\n  Workbook.prototype.switchNumberFormat = function (numberFormat, type) {\n    var format = this.getNumberFormat(numberFormat, type);\n    if (format !== numberFormat) {\n      var numFmt = this.mNumFmt.get(numberFormat);\n      if (numFmt !== undefined) {\n        numFmt.formatCode = format;\n        if (this.mNumFmt.has(format)) {\n          for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\n            var cellStyleXfs = _a[_i];\n            if (cellStyleXfs.numFmtId === numFmt.numFmtId) {\n              cellStyleXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\n            }\n          }\n          for (var _b = 0, _c = this.mCellXfs; _b < _c.length; _b++) {\n            var cellXfs = _c[_b];\n            if (cellXfs.numFmtId === numFmt.numFmtId) {\n              cellXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\n            }\n          }\n        }\n      }\n    }\n  };\n  Workbook.prototype.changeNumberFormats = function (value) {\n    if (typeof value == \"string\") {\n      var regex = new RegExp(this.currency, 'g');\n      value = value.replace(regex, '[$' + this.currency + ']');\n    } else if (typeof value == \"object\") {\n      for (var i = 0; i < value.length; i++) {\n        value[i] = value[i].replace(this.currency, '[$' + this.currency + ']');\n      }\n    }\n    return value;\n  };\n  Workbook.prototype.getNumberFormat = function (numberFormat, type) {\n    var returnFormat;\n    switch (type) {\n      case 'number':\n        try {\n          returnFormat = this.intl.getNumberPattern({\n            format: numberFormat,\n            currency: this.currency,\n            useGrouping: true\n          }, true);\n          if (this.currency.length > 1) {\n            returnFormat = this.changeNumberFormats(returnFormat);\n          }\n        } catch (error) {\n          returnFormat = numberFormat;\n        }\n        break;\n      case 'datetime':\n        try {\n          returnFormat = this.intl.getDatePattern({\n            skeleton: numberFormat,\n            type: 'dateTime'\n          }, true);\n        } catch (error) {\n          try {\n            returnFormat = this.intl.getDatePattern({\n              format: numberFormat,\n              type: 'dateTime'\n            }, true);\n          } catch (error) {\n            returnFormat = numberFormat;\n          }\n        }\n        break;\n      case 'date':\n        try {\n          returnFormat = this.intl.getDatePattern({\n            skeleton: numberFormat,\n            type: 'date'\n          }, true);\n        } catch (error) {\n          try {\n            returnFormat = this.intl.getDatePattern({\n              format: numberFormat,\n              type: 'date'\n            }, true);\n          } catch (error) {\n            returnFormat = numberFormat;\n          }\n        }\n        break;\n      case 'time':\n        try {\n          returnFormat = this.intl.getDatePattern({\n            skeleton: numberFormat,\n            type: 'time'\n          }, true);\n        } catch (error) {\n          try {\n            returnFormat = this.intl.getDatePattern({\n              format: numberFormat,\n              type: 'time'\n            }, true);\n          } catch (error) {\n            returnFormat = numberFormat;\n          }\n        }\n        break;\n      default:\n        returnFormat = numberFormat;\n        break;\n    }\n    return returnFormat;\n  };\n  /* tslint:disable:no-any */\n  Workbook.prototype.parserBorder = function (json, border) {\n    if (json.color !== null && json.color !== undefined) {\n      border.color = json.color;\n    } else {\n      border.color = '#000000';\n    }\n    if (json.lineStyle !== null && json.lineStyle !== undefined) {\n      border.lineStyle = json.lineStyle;\n    } else {\n      border.lineStyle = 'thin';\n    }\n  };\n  Workbook.prototype.processCellStyle = function (style) {\n    if (style.isGlobalStyle) {\n      this.processNumFormatId(style);\n      this.mStyles.push(style);\n      return this.mStyles.length;\n    } else {\n      var compareResult = this.compareStyle(style);\n      if (!compareResult.result) {\n        this.processNumFormatId(style);\n        this.mStyles.push(style);\n        return this.mStyles.length;\n      } else {\n        //Return the index of the already existing style.\n        return compareResult.index;\n      }\n    }\n  };\n  Workbook.prototype.processNumFormatId = function (style) {\n    if (style.numberFormat !== 'GENERAL' && !this.mNumFmt.has(style.numberFormat)) {\n      var id = this.mNumFmt.size + 164;\n      this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\n    }\n  };\n  Workbook.prototype.isNewFont = function (toCompareStyle) {\n    var result = false;\n    var index = 0;\n    for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\n      var font = _a[_i];\n      index++;\n      var fontColor = undefined;\n      if (toCompareStyle.fontColor !== undefined) {\n        fontColor = 'FF' + toCompareStyle.fontColor.replace('#', '');\n      }\n      result = font.color === fontColor && font.b === toCompareStyle.bold && font.i === toCompareStyle.italic && font.u === toCompareStyle.underline && font.strike === toCompareStyle.strikeThrough && font.name === toCompareStyle.fontName && font.sz === toCompareStyle.fontSize;\n      if (result) {\n        break;\n      }\n    }\n    index = index - 1;\n    return {\n      index: index,\n      result: result\n    };\n  };\n  Workbook.prototype.isNewBorder = function (toCompareStyle) {\n    var bStyle = new CellStyle();\n    if (this.isAllBorder(toCompareStyle.borders)) {\n      return bStyle.borders.all.color === toCompareStyle.borders.all.color && bStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle;\n    } else {\n      return bStyle.borders.left.color === toCompareStyle.borders.left.color && bStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle && bStyle.borders.right.color === toCompareStyle.borders.right.color && bStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle && bStyle.borders.top.color === toCompareStyle.borders.top.color && bStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle && bStyle.borders.bottom.color === toCompareStyle.borders.bottom.color && bStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle;\n    }\n  };\n  Workbook.prototype.isAllBorder = function (toCompareBorder) {\n    var allBorderStyle = new CellStyle();\n    return allBorderStyle.borders.all.color !== toCompareBorder.all.color && allBorderStyle.borders.all.lineStyle !== toCompareBorder.all.lineStyle;\n  };\n  Workbook.prototype.compareStyle = function (toCompareStyle) {\n    var result = true;\n    var index = 0;\n    var globalStyleIndex = 0;\n    for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\n      var baseStyle = _a[_i];\n      result = baseStyle.isGlobalStyle ? false : baseStyle.backColor === toCompareStyle.backColor && baseStyle.bold === toCompareStyle.bold && baseStyle.numFmtId === toCompareStyle.numFmtId && baseStyle.numberFormat === toCompareStyle.numberFormat && baseStyle.type === toCompareStyle.type && baseStyle.fontColor === toCompareStyle.fontColor && baseStyle.fontName === toCompareStyle.fontName && baseStyle.fontSize === toCompareStyle.fontSize && baseStyle.hAlign === toCompareStyle.hAlign && baseStyle.italic === toCompareStyle.italic && baseStyle.underline === toCompareStyle.underline && baseStyle.strikeThrough === toCompareStyle.strikeThrough && baseStyle.vAlign === toCompareStyle.vAlign && baseStyle.indent === toCompareStyle.indent && baseStyle.rotation === toCompareStyle.rotation && baseStyle.wrapText === toCompareStyle.wrapText && baseStyle.borders.all.color === toCompareStyle.borders.all.color && baseStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle && baseStyle.borders.left.color === toCompareStyle.borders.left.color && baseStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle && baseStyle.borders.right.color === toCompareStyle.borders.right.color && baseStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle && baseStyle.borders.top.color === toCompareStyle.borders.top.color && baseStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle && baseStyle.borders.bottom.color === toCompareStyle.borders.bottom.color && baseStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle;\n      if (result) {\n        index = baseStyle.index;\n        break;\n      }\n    }\n    return {\n      index: index,\n      result: result\n    };\n  };\n  Workbook.prototype.contains = function (array, item) {\n    var index = array.indexOf(item);\n    return index > -1 && index < array.length;\n  };\n  Workbook.prototype.getCellValueType = function (value) {\n    if (value instanceof Date) {\n      return 'datetime';\n    } else if (typeof value === 'boolean') {\n      return 'boolean';\n    } else if (typeof value === 'number') {\n      return 'number';\n    } else {\n      return 'string';\n    }\n  };\n  Workbook.prototype.parseCellType = function (cell) {\n    var type = cell.type;\n    var saveType;\n    var value = cell.value;\n    switch (type) {\n      case 'datetime':\n        value = this.toOADate(value);\n        if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\n          if (this.globalStyles.has(cell.cellStyle.name)) {\n            var value_1 = this.globalStyles.get(cell.cellStyle.name);\n            this.switchNumberFormat(value_1.format, value_1.type);\n          }\n        }\n        saveType = 'n';\n        break;\n      //TODO: Update the number format index and style\n      case 'boolean':\n        value = value ? 1 : 0;\n        saveType = 'b';\n        break;\n      case 'number':\n        saveType = 'n';\n        if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\n          if (this.globalStyles.has(cell.cellStyle.name)) {\n            this.switchNumberFormat(this.globalStyles.get(cell.cellStyle.name).format, 'number');\n          }\n        }\n        break;\n      case 'string':\n        this.sharedStringCount++;\n        saveType = 's';\n        var sstvalue = this.processCellValue(value, cell);\n        if (!this.contains(this.sharedString, sstvalue)) {\n          this.sharedString.push(sstvalue);\n        }\n        value = this.sharedString.indexOf(sstvalue);\n        break;\n      default:\n        break;\n    }\n    cell.saveType = saveType;\n    cell.value = value;\n  };\n  Workbook.prototype.parserImages = function (json, sheet) {\n    var imagesLength = json.length;\n    sheet.images = [];\n    var imageId = 0;\n    for (var p = 0; p < imagesLength; p++) {\n      var image = this.parserImage(json[p]);\n      sheet.images.push(image);\n    }\n  };\n  Workbook.prototype.parseFilters = function (json, sheet) {\n    sheet.autoFilters = new AutoFilters();\n    if (json.row !== null && json.row !== undefined) sheet.autoFilters.row = json.row;else throw new Error('Argument Null Exception: row null or empty');\n    if (json.lastRow !== null && json.lastRow !== undefined) sheet.autoFilters.lastRow = json.lastRow;else throw new Error('Argument Null Exception: lastRow cannot be null or empty');\n    if (json.column !== null && json.column !== undefined) sheet.autoFilters.column = json.column;else throw new Error('Argument Null Exception: column cannot be null or empty');\n    if (json.lastColumn !== null && json.row !== undefined) sheet.autoFilters.lastColumn = json.lastColumn;else throw new Error('Argument Null Exception: lastColumn cannot be null or empty');\n  };\n  Workbook.prototype.parserImage = function (json) {\n    var image = new Image();\n    if (json.image !== null && json.image !== undefined) {\n      image.image = json.image;\n    }\n    if (json.row !== null && json.row !== undefined) {\n      image.row = json.row;\n    }\n    if (json.column !== null && json.column !== undefined) {\n      image.column = json.column;\n    }\n    if (json.lastRow !== null && json.lastRow !== undefined) {\n      image.lastRow = json.lastRow;\n    }\n    if (json.lastColumn !== null && json.lastColumn !== undefined) {\n      image.lastColumn = json.lastColumn;\n    }\n    if (json.width !== null && json.width !== undefined) {\n      image.width = json.width;\n    }\n    if (json.height !== null && json.height !== undefined) {\n      image.height = json.height;\n    }\n    if (json.horizontalFlip !== null && json.horizontalFlip !== undefined) {\n      image.horizontalFlip = json.horizontalFlip;\n    }\n    if (json.verticalFlip !== null && json.verticalFlip !== undefined) {\n      image.verticalFlip = json.verticalFlip;\n    }\n    if (json.rotation !== null && json.rotation !== undefined) {\n      image.rotation = json.rotation;\n    }\n    return image;\n  };\n  /**\n   * Returns a Promise with a Blob based on the specified BlobSaveType and optional encoding.\n   * @param {BlobSaveType} blobSaveType - A string indicating the type of Blob to generate ('text/csv' or other).\n   * @param {string} [encodingType] - The supported encoding types are \"ansi\", \"unicode\" and \"utf8\".\n   */\n  /* tslint:disable:no-any */\n  Workbook.prototype.saveAsBlob = function (blobSaveType, encodingType) {\n    var _this = this;\n    switch (blobSaveType) {\n      case 'text/csv':\n        return new Promise(function (resolve, reject) {\n          var obj = {};\n          obj.blobData = _this.csvHelper.saveAsBlob(encodingType);\n          resolve(obj);\n        });\n      default:\n        return new Promise(function (resolve, reject) {\n          _this.saveInternal();\n          _this.mArchive.saveAsBlob().then(function (blob) {\n            var obj = {};\n            obj.blobData = new Blob([blob], {\n              type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n            });\n            resolve(obj);\n          });\n        });\n    }\n  };\n  Workbook.prototype.save = function (fileName, proxyUrl) {\n    var _this = this;\n    if (fileName === null || fileName === undefined || fileName === '') {\n      throw new Error('Argument Null Exception: fileName cannot be null or empty');\n    }\n    var xlsxMatch = fileName.match('.xlsx$');\n    var csvMatch = fileName.match('.csv$');\n    if (xlsxMatch !== null && xlsxMatch[0] === '.' + this.mSaveType) {\n      this.saveInternal();\n      this.mArchive.save(fileName).then(function () {\n        _this.mArchive.destroy();\n      });\n    } else if (csvMatch !== null && csvMatch[0] === '.' + this.mSaveType) {\n      this.csvHelper.save(fileName);\n    } else {\n      throw Error('Save type and file extension is different.');\n    }\n  };\n  Workbook.prototype.saveInternal = function () {\n    this.saveWorkbook();\n    this.saveWorksheets();\n    this.saveSharedString();\n    this.saveStyles();\n    this.saveApp(this.builtInProperties);\n    this.saveCore(this.builtInProperties);\n    this.saveContentType();\n    this.saveTopLevelRelation();\n    this.saveWorkbookRelation();\n  };\n  Workbook.prototype.saveWorkbook = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var workbookTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><workbook xmlns:r = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns= \"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><workbookPr codeName=\"ThisWorkbook\" defaultThemeVersion= \"153222\"/><bookViews><workbookView activeTab=\"0\"/></bookViews>';\n    var sheets = '<sheets>';\n    var length = this.worksheets.length;\n    for (var i = 0; i < length; i++) {\n      /* tslint:disable-next-line:max-line-length */\n      var sheetName = this.worksheets[i].name;\n      sheetName = sheetName.replace(\"&\", \"&amp;\");\n      sheetName = sheetName.replace(\"<\", \"&lt;\");\n      sheetName = sheetName.replace(\">\", \"&gt;\");\n      sheetName = sheetName.replace(\"\\\"\", \"&quot;\");\n      sheets += '<sheet name=\"' + sheetName + '\" sheetId=\"' + (i + 1).toString() + '\" r:id =\"rId' + (i + 1).toString() + '\" />';\n    }\n    sheets += '</sheets>';\n    workbookTemp += sheets;\n    if (this.printTitles.size > 0) {\n      var printTitle_1 = '<definedNames>';\n      this.printTitles.forEach(function (value, key) {\n        printTitle_1 += '<definedName name=\"_xlnm.Print_Titles\" localSheetId=\"' + key + '\">' + value + '</definedName>';\n      });\n      printTitle_1 += '</definedNames>';\n      workbookTemp += printTitle_1;\n    }\n    this.addToArchive(workbookTemp + '</workbook>', 'xl/workbook.xml');\n  };\n  Workbook.prototype.saveWorksheets = function () {\n    var length = this.worksheets.length;\n    for (var i = 0; i < length; i++) {\n      this.saveWorksheet(this.worksheets[i], i);\n    }\n  };\n  Workbook.prototype.saveWorksheet = function (sheet, index) {\n    var sheetBlob = new BlobHelper();\n    /* tslint:disable-next-line:max-line-length */\n    var sheetString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><worksheet xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns:x14=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n    if (!sheet.isSummaryRowBelow) {\n      sheetString += '<sheetPr>' + '<outlinePr ' + 'summaryBelow=\"0\" >' + '</outlinePr>' + '</sheetPr>';\n    } else {\n      sheetString += '<sheetPr />';\n    }\n    sheetString += this.saveSheetView(sheet);\n    if (sheet.columns !== undefined) {\n      var colString = '<cols>';\n      for (var _i = 0, _a = sheet.columns; _i < _a.length; _i++) {\n        var column = _a[_i];\n        /* tslint:disable-next-line:max-line-length */\n        if (column.width !== undefined) {\n          colString += '<col min=\"' + column.index + '\" max=\"' + column.index + '\" width=\"' + this.pixelsToColumnWidth(column.width) + '\" customWidth=\"1\" />';\n        } else {\n          colString += '<col min=\"' + column.index + '\" max=\"' + column.index + '\" width=\"' + '8.43' + '\" customWidth=\"1\" />';\n        }\n      }\n      sheetString += colString + '</cols>';\n    }\n    sheetString += '<sheetData>';\n    sheetBlob.append(sheetString);\n    sheetString = '';\n    if (sheet.rows !== undefined) {\n      for (var _b = 0, _c = sheet.rows; _b < _c.length; _b++) {\n        var row = _c[_b];\n        var rowString = '<row r=\"' + row.index + '\" ';\n        if (!isNullOrUndefined(row.spans)) {\n          rowString += 'spans=\"' + row.spans + '\" ';\n        }\n        if (row.height !== undefined) {\n          rowString += 'ht=\"' + this.pixelsToRowHeight(row.height) + '\" customHeight=\"1\" ';\n        }\n        if (row.grouping !== undefined) {\n          if (row.grouping.isHidden) {\n            rowString += 'hidden=\"1\" ';\n          }\n          if (row.grouping.outlineLevel !== undefined) {\n            rowString += 'outlineLevel=\"' + row.grouping.outlineLevel + '\" ';\n          }\n          if (row.grouping.isCollapsed) {\n            rowString += 'collapsed=\"1\" ';\n          }\n        }\n        rowString += '>';\n        for (var _d = 0, _e = row.cells; _d < _e.length; _d++) {\n          var cell = _e[_d];\n          if (cell !== undefined && (cell.value !== undefined || cell.cellStyle !== undefined)) {\n            rowString += '<c r=\"' + cell.refName + '\" ';\n            if (cell.saveType !== undefined) {\n              rowString += 't=\"' + cell.saveType + '\" ';\n            }\n            if (cell.styleIndex !== undefined) {\n              rowString += 's=\"' + cell.styleIndex + '\" ';\n            }\n            rowString += ' >';\n            if (cell.formula !== undefined) {\n              rowString += '<f>' + cell.formula + '</f>';\n            }\n            if (cell.value !== undefined) {\n              rowString += '<v>' + cell.value + '</v></c>';\n            } else {\n              rowString += '</c>';\n            }\n          }\n        }\n        rowString += '</row>';\n        sheetBlob.append(rowString);\n      }\n    }\n    sheetString += '</sheetData>';\n    /* tslint:disable-next-line:max-line-length */\n    if (sheet.autoFilters !== null && sheet.autoFilters !== undefined) sheetString += '<autoFilter ref=\"' + this.getCellName(sheet.autoFilters.row, sheet.autoFilters.column) + ':' + this.getCellName(sheet.autoFilters.lastRow, sheet.autoFilters.lastColumn) + '\"/>';\n    if (sheet.mergeCells.length > 0) {\n      sheetString += '<mergeCells count=\"' + sheet.mergeCells.length + '\">';\n      for (var _f = 0, _g = sheet.mergeCells; _f < _g.length; _f++) {\n        var mCell = _g[_f];\n        sheetString += '<mergeCell ref=\"' + mCell.ref + '\" />';\n      }\n      sheetString += '</mergeCells>';\n    }\n    if (sheet.hyperLinks.length > 0) {\n      sheetString += '<hyperlinks>';\n      for (var _h = 0, _j = sheet.hyperLinks; _h < _j.length; _h++) {\n        var hLink = _j[_h];\n        sheetString += '<hyperlink ref=\"' + hLink.ref + '\" r:id=\"rId' + hLink.rId + '\" />';\n      }\n      sheetString += '</hyperlinks>';\n    }\n    /* tslint:disable-next-line:max-line-length */\n    sheetString += '<pageMargins left=\"0.75\" right=\"0.75\" top=\"1\" bottom=\"1\" header=\"0.5\" footer=\"0.5\" /><headerFooter scaleWithDoc=\"1\" alignWithMargins=\"0\" differentFirst=\"0\" differentOddEven=\"0\" />';\n    if (sheet.images != undefined && sheet.images.length > 0) {\n      this.drawingCount++;\n      this.saveDrawings(sheet, sheet.index);\n      sheetString += '<drawing r:id=\"rId' + (sheet.hyperLinks.length + 1) + '\"/>';\n    }\n    this.addToArchive(this.saveSheetRelations(sheet), 'xl/worksheets/_rels/sheet' + sheet.index + '.xml.rels');\n    sheetBlob.append(sheetString + '</worksheet>');\n    this.addToArchive(sheetBlob.getBlob(), 'xl/worksheets' + '/sheet' + (index + 1) + '.xml');\n  };\n  Workbook.prototype.saveDrawings = function (sheet, index) {\n    var drawings = new BlobHelper();\n    /* tslint:disable-next-line:max-line-length */\n    var sheetDrawingString = '<xdr:wsDr xmlns:xdr=\"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing\" xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">';\n    if (sheet.images !== undefined) {\n      var imgId = 0;\n      for (var _i = 0, _a = sheet.images; _i < _a.length; _i++) {\n        var pic = _a[_i];\n        if (pic.height !== undefined && pic.width !== undefined) {\n          this.updatelastRowOffset(sheet, pic);\n          this.updatelastColumnOffSet(sheet, pic);\n          pic.lastRow -= 1;\n          pic.lastColumn -= 1;\n        } else if (pic.lastRow !== undefined && pic.lastColumn !== undefined) {\n          pic.lastRowOffset = 0;\n          pic.lastColOffset = 0;\n        }\n        imgId++;\n        sheetDrawingString += '<xdr:twoCellAnchor editAs=\"oneCell\">';\n        sheetDrawingString += '<xdr:from><xdr:col>';\n        //col\n        sheetDrawingString += pic.column - 1;\n        sheetDrawingString += '</xdr:col><xdr:colOff>';\n        //colOff\n        sheetDrawingString += 0;\n        sheetDrawingString += '</xdr:colOff><xdr:row>';\n        //row\n        sheetDrawingString += pic.row - 1;\n        sheetDrawingString += '</xdr:row><xdr:rowOff>';\n        //rowOff\n        sheetDrawingString += 0;\n        sheetDrawingString += '</xdr:rowOff></xdr:from>';\n        sheetDrawingString += '<xdr:to><xdr:col>';\n        //col\n        sheetDrawingString += pic.lastColumn;\n        sheetDrawingString += '</xdr:col><xdr:colOff>';\n        //colOff\n        sheetDrawingString += pic.lastColOffset;\n        sheetDrawingString += '</xdr:colOff><xdr:row>';\n        //row\n        sheetDrawingString += pic.lastRow;\n        sheetDrawingString += '</xdr:row><xdr:rowOff>';\n        //rowOff\n        sheetDrawingString += pic.lastRowOffset;\n        sheetDrawingString += '</xdr:rowOff></xdr:to>';\n        sheetDrawingString += '<xdr:pic>';\n        sheetDrawingString += '<xdr:nvPicPr>';\n        sheetDrawingString += '<xdr:cNvPr id=\"' + imgId + '\" name=\"Picture ' + imgId + '\"> </xdr:cNvPr>';\n        sheetDrawingString += '<xdr:cNvPicPr><a:picLocks noChangeAspect=\"1\"/></xdr:cNvPicPr> </xdr:nvPicPr>';\n        sheetDrawingString += '<xdr:blipFill>';\n        /* tslint:disable-next-line:max-line-length */\n        sheetDrawingString += '<a:blip xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" r:embed=\"rId' + imgId + '\" cstate=\"print\">';\n        sheetDrawingString += '</a:blip><a:stretch><a:fillRect /></a:stretch></xdr:blipFill>';\n        sheetDrawingString += '<xdr:spPr>';\n        sheetDrawingString += '<a:xfrm';\n        if (pic.rotation != undefined && pic.rotation <= 3600 && pic.rotation >= -3600) {\n          sheetDrawingString += ' rot=\"' + pic.rotation * 60000 + '\"';\n        }\n        if (pic.verticalFlip != undefined && pic.verticalFlip != false) {\n          sheetDrawingString += ' flipV=\"1\"';\n        }\n        if (pic.horizontalFlip != undefined && pic.horizontalFlip != false) {\n          sheetDrawingString += ' flipH=\"1\"';\n        }\n        sheetDrawingString += '/>';\n        sheetDrawingString += '<a:prstGeom prst=\"rect\"><a:avLst /></a:prstGeom></xdr:spPr>';\n        sheetDrawingString += '</xdr:pic><xdr:clientData /></xdr:twoCellAnchor>';\n        var imageFile = new BlobHelper();\n        var imageData = this.convertBase64toImage(pic.image);\n        this.imageCount += 1;\n        this.addToArchive(imageData, 'xl/media/image' + this.imageCount + '.png');\n      }\n      drawings.append(sheetDrawingString);\n      drawings.append('</xdr:wsDr>');\n      this.saveDrawingRelations(sheet);\n      this.addToArchive(drawings.getBlob(), 'xl/drawings/drawing' + this.drawingCount + '.xml');\n    }\n  };\n  Workbook.prototype.updatelastRowOffset = function (sheet, picture) {\n    var iCurHeight = picture.height;\n    var iCurRow = picture.row;\n    var iCurOffset = 0;\n    while (iCurHeight >= 0) {\n      var iRowHeight = 0;\n      if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined) iRowHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);else iRowHeight = this.convertToPixels(15);\n      var iSpaceInCell = iRowHeight - iCurOffset * iRowHeight / 256;\n      if (iSpaceInCell > iCurHeight) {\n        picture.lastRow = iCurRow;\n        picture.lastRowOffset = iCurOffset + iCurHeight * 256 / iRowHeight;\n        var rowHiddenHeight = 0;\n        if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined) rowHiddenHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);else rowHiddenHeight = this.convertToPixels(15);\n        picture.lastRowOffset = rowHiddenHeight * picture.lastRowOffset / 256;\n        picture.lastRowOffset = Math.round(picture.lastRowOffset / this.unitsProportions[7]);\n        break;\n      } else {\n        iCurHeight -= iSpaceInCell;\n        iCurRow++;\n        iCurOffset = 0;\n      }\n    }\n  };\n  Workbook.prototype.updatelastColumnOffSet = function (sheet, picture) {\n    var iCurWidth = picture.width;\n    var iCurCol = picture.column;\n    var iCurOffset = 0;\n    while (iCurWidth >= 0) {\n      var iColWidth = 0;\n      if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined) iColWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol - 1].width);else iColWidth = this.ColumnWidthToPixels(8.43);\n      var iSpaceInCell = iColWidth - iCurOffset * iColWidth / 1024;\n      if (iSpaceInCell > iCurWidth) {\n        picture.lastColumn = iCurCol;\n        picture.lastColOffset = iCurOffset + iCurWidth * 1024 / iColWidth;\n        var colHiddenWidth = 0;\n        if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined) colHiddenWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol - 1].width);else colHiddenWidth = this.ColumnWidthToPixels(8.43);\n        picture.lastColOffset = colHiddenWidth * picture.lastColOffset / 1024;\n        picture.lastColOffset = Math.round(picture.lastColOffset / this.unitsProportions[7]);\n        break;\n      } else {\n        iCurWidth -= iSpaceInCell;\n        iCurCol++;\n        iCurOffset = 0;\n      }\n    }\n  };\n  Workbook.prototype.convertToPixels = function (value) {\n    return value * this.unitsProportions[6];\n  };\n  Workbook.prototype.convertBase64toImage = function (img) {\n    var byteStr = window.atob(img);\n    var buffer = new ArrayBuffer(byteStr.length);\n    var data = new Uint8Array(buffer);\n    for (var i = 0; i < byteStr.length; i++) {\n      data[i] = byteStr.charCodeAt(i);\n    }\n    var blob = new Blob([data], {\n      type: 'image/png'\n    });\n    return blob;\n  };\n  Workbook.prototype.saveDrawingRelations = function (sheet) {\n    /* tslint:disable-next-line:max-line-length */\n    var drawingRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n    var length = sheet.images.length;\n    var id = this.imageCount - sheet.images.length;\n    for (var i = 1; i <= length; i++) {\n      id++;\n      /* tslint:disable-next-line:max-line-length */\n      drawingRelation += '<Relationship Id=\"rId' + i + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"../media/image' + id + '.png\" />';\n    }\n    this.addToArchive(drawingRelation + '</Relationships>', 'xl/drawings/_rels/drawing' + this.drawingCount + '.xml.rels');\n  };\n  Workbook.prototype.pixelsToColumnWidth = function (pixels) {\n    var dDigitWidth = 7;\n    var val = pixels > dDigitWidth + 5 ? this.trunc((pixels - 5) / dDigitWidth * 100 + 0.5) / 100 : pixels / (dDigitWidth + 5);\n    return val > 1 ? (val * dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0 : val * (dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0;\n  };\n  Workbook.prototype.ColumnWidthToPixels = function (val) {\n    var dDigitWidth = 7;\n    var fileWidth = val > 1 ? (val * dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0 : val * (dDigitWidth + 5) / dDigitWidth * 256.0 / 256.0;\n    return this.trunc((256 * fileWidth + this.trunc(128 / dDigitWidth)) / 256 * dDigitWidth);\n  };\n  Workbook.prototype.trunc = function (x) {\n    var n = x - x % 1;\n    return n === 0 && (x < 0 || x === 0 && 1 / x !== 1 / 0) ? -0 : n;\n  };\n  Workbook.prototype.pixelsToRowHeight = function (pixels) {\n    return pixels * this.unitsProportions[5] / this.unitsProportions[6];\n  };\n  Workbook.prototype.saveSheetRelations = function (sheet) {\n    /* tslint:disable-next-line:max-line-length */\n    var relStr = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n    for (var _i = 0, _a = sheet.hyperLinks; _i < _a.length; _i++) {\n      var hLink = _a[_i];\n      /* tslint:disable-next-line:max-line-length */\n      relStr += '<Relationship Id=\"rId' + hLink.rId + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink\" Target=\"' + this.processString(hLink.target) + '\" TargetMode=\"External\" />';\n    }\n    if (sheet.images != undefined && sheet.images.length > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      relStr += '<Relationship Id=\"rId' + (sheet.hyperLinks.length + 1) + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing\" Target=\"../drawings/drawing' + this.drawingCount + '.xml\" />';\n    }\n    relStr += '</Relationships>';\n    return relStr;\n  };\n  Workbook.prototype.saveSheetView = function (sheet) {\n    var paneString = '<sheetViews><sheetView workbookViewId=\"0\" ';\n    if (sheet.enableRtl === true) {\n      paneString += 'rightToLeft=\"1\"';\n    }\n    if (sheet.showGridLines === false) {\n      paneString += 'showGridLines=\"0\" >';\n    } else {\n      paneString += '>';\n    }\n    if (sheet.freezePanes !== undefined) {\n      paneString += '<pane state=\"frozen\"' + ' topLeftCell=\"' + sheet.freezePanes.leftCell + '\" ';\n      if (sheet.freezePanes.row !== 0) {\n        paneString += 'ySplit=\"' + sheet.freezePanes.row + '\" ';\n      }\n      if (sheet.freezePanes.column !== 0) {\n        paneString += 'xSplit=\"' + sheet.freezePanes.column + '\" ';\n      }\n      paneString += '/>';\n    }\n    paneString += '</sheetView></sheetViews > ';\n    return paneString;\n  };\n  Workbook.prototype.saveSharedString = function () {\n    var length = this.sharedString.length;\n    if (length > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      var sstStart = '<?xml version=\"1.0\" encoding=\"utf-8\"?><sst uniqueCount=\"' + length + '\" count=\"' + this.sharedStringCount + '\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n      var si = '';\n      for (var i = 0; i < length; i++) {\n        if (this.sharedString[i].indexOf('<r>') !== 0) {\n          si += '<si><t>';\n          si += this.processString(this.sharedString[i]);\n          si += '</t></si>';\n        } else {\n          si += '<si>';\n          si += this.sharedString[i];\n          si += '</si>';\n        }\n      }\n      si += '</sst>';\n      this.addToArchive(sstStart + si, 'xl/sharedStrings.xml');\n    }\n  };\n  Workbook.prototype.processString = function (value) {\n    if (typeof value == \"string\") {\n      if (value.indexOf('&') !== -1) {\n        value = value.replace(/&/g, '&amp;');\n      }\n      if (value.indexOf('<') !== -1) {\n        value = value.replace(/</g, '&lt;');\n      }\n      if (value.indexOf('>') !== -1) {\n        value = value.replace(/>/g, '&gt;');\n      }\n      if (value.indexOf('\\v') !== -1) {\n        value = value.replace(/\\v/g, '_x000B_');\n      }\n    } else if (typeof value == \"object\") {\n      for (var i = 0; i < value.length; i++) {\n        if (value[i].indexOf('&') !== -1) {\n          value[i] = value[i].replace(/&/g, '&amp;');\n        }\n        if (value[i].indexOf('<') !== -1) {\n          value[i] = value[i].replace(/</g, '&lt;');\n        }\n        if (value[i].indexOf('>') !== -1) {\n          value[i] = value[i].replace(/>/g, '&gt;');\n        }\n        if (value[i].indexOf('\\v') !== -1) {\n          value[i] = value[i].replace(/\\v/g, '_x000B_');\n        }\n      }\n    }\n    return value;\n  };\n  Workbook.prototype.saveStyles = function () {\n    this.updateCellXfsStyleXfs();\n    /* tslint:disable-next-line:max-line-length */\n    var styleTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><styleSheet xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" mc:Ignorable=\"x14ac\" xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n    styleTemp += this.saveNumberFormats();\n    styleTemp += this.saveFonts();\n    styleTemp += this.saveFills();\n    styleTemp += this.saveBorders();\n    styleTemp += this.saveCellStyleXfs();\n    styleTemp += this.saveCellXfs();\n    styleTemp += this.saveCellStyles();\n    this.addToArchive(styleTemp + '</styleSheet>', 'xl/styles.xml');\n  };\n  Workbook.prototype.updateCellXfsStyleXfs = function () {\n    for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\n      var style = _a[_i];\n      var cellXfs = undefined;\n      if (style.isGlobalStyle) {\n        cellXfs = new CellStyleXfs();\n        cellXfs.xfId = style.index - 1;\n      } else {\n        cellXfs = new CellXfs();\n        cellXfs.xfId = 0;\n      }\n      //Add font\n      var compareFontResult = this.isNewFont(style);\n      if (!compareFontResult.result) {\n        var font = new Font();\n        font.b = style.bold;\n        font.i = style.italic;\n        font.name = style.fontName;\n        font.sz = style.fontSize;\n        font.u = style.underline;\n        font.strike = style.strikeThrough;\n        font.color = 'FF' + style.fontColor.replace('#', '');\n        this.mFonts.push(font);\n        cellXfs.fontId = this.mFonts.length - 1;\n      } else {\n        cellXfs.fontId = compareFontResult.index;\n      }\n      //Add fill\n      if (style.backColor !== 'none') {\n        var backColor = 'FF' + style.backColor.replace('#', '');\n        if (this.mFills.has(backColor)) {\n          var fillId = this.mFills.get(backColor);\n          cellXfs.fillId = fillId;\n        } else {\n          var fillId = this.mFills.size + 2;\n          this.mFills.set(backColor, fillId);\n          cellXfs.fillId = fillId;\n        }\n      } else {\n        cellXfs.fillId = 0;\n      }\n      //Add border            \n      if (!this.isNewBorder(style)) {\n        this.mBorders.push(style.borders);\n        cellXfs.borderId = this.mBorders.length;\n      } else {\n        cellXfs.borderId = 0;\n      }\n      //Add Number Format            \n      if (style.numberFormat !== 'GENERAL') {\n        if (this.mNumFmt.has(style.numberFormat)) {\n          var numFmt = this.mNumFmt.get(style.numberFormat);\n          cellXfs.numFmtId = numFmt.numFmtId;\n        } else {\n          var id = this.mNumFmt.size + 164;\n          this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\n          cellXfs.numFmtId = id;\n        }\n      } else {\n        if (style.numberFormat === 'GENERAL' && style.numFmtId === 14) {\n          cellXfs.numFmtId = 14;\n        } else {\n          cellXfs.numFmtId = 0;\n        }\n      }\n      //Add alignment            \n      if (!style.isGlobalStyle) {\n        cellXfs.applyAlignment = 1;\n      }\n      cellXfs.alignment = new Alignment();\n      cellXfs.alignment.indent = style.indent;\n      cellXfs.alignment.horizontal = style.hAlign;\n      cellXfs.alignment.vertical = style.vAlign;\n      cellXfs.alignment.wrapText = style.wrapText ? 1 : 0;\n      cellXfs.alignment.rotation = style.rotation;\n      if (style.isGlobalStyle) {\n        this.mCellStyleXfs.push(cellXfs);\n        this.mCellXfs.push(cellXfs);\n      } else {\n        //Add cellxfs\n        this.mCellXfs.push(cellXfs);\n      }\n    }\n  };\n  Workbook.prototype.saveNumberFormats = function () {\n    if (this.mNumFmt.size >= 1) {\n      var numFmtStyle_1 = '<numFmts count=\"' + this.mNumFmt.size + '\">';\n      this.mNumFmt.forEach(function (value, key) {\n        numFmtStyle_1 += '<numFmt numFmtId=\"' + value.numFmtId + '\" formatCode=\"' + value.formatCode.replace(/\"/g, '&quot;') + '\" />';\n      });\n      return numFmtStyle_1 += '</numFmts>';\n    } else {\n      return '';\n    }\n  };\n  Workbook.prototype.saveFonts = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var fontStyle = '<fonts count=\"' + this.mFonts.length + '\">';\n    if (this.mFonts.length >= 1) {\n      for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\n        var font = _a[_i];\n        fontStyle += '<font>';\n        if (font.b) {\n          fontStyle += '<b />';\n        }\n        if (font.i) {\n          fontStyle += '<i />';\n        }\n        if (font.u) {\n          fontStyle += '<u />';\n        }\n        if (font.strike) {\n          fontStyle += '<strike />';\n        }\n        fontStyle += '<sz val=\"' + font.sz + '\" />';\n        fontStyle += '<color rgb=\"' + font.color + '\" />';\n        fontStyle += '<name val=\"' + font.name + '\" /></font>';\n      }\n    }\n    return fontStyle + '</fonts>';\n  };\n  Workbook.prototype.saveFills = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var fillsStyle = '<fills count=\"' + (this.mFills.size + 2) + '\"><fill><patternFill patternType=\"none\"></patternFill></fill><fill><patternFill patternType=\"gray125\"></patternFill></fill>';\n    if (this.mFills.size >= 1) {\n      this.mFills.forEach(function (value, key) {\n        /* tslint:disable-next-line:max-line-length */\n        fillsStyle += '<fill><patternFill patternType=\"solid\"><fgColor rgb=\"' + key + '\" /><bgColor rgb=\"FFFFFFFF\" /></patternFill></fill>';\n      });\n    }\n    return fillsStyle + '</fills>';\n  };\n  Workbook.prototype.saveBorders = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var bordersStyle = '<borders count=\"' + (this.mBorders.length + 1) + '\"><border><left /><right /><top /><bottom /><diagonal /></border>';\n    if (this.mBorders.length >= 1) {\n      for (var _i = 0, _a = this.mBorders; _i < _a.length; _i++) {\n        var borders = _a[_i];\n        if (this.isAllBorder(borders)) {\n          var color = borders.all.color.replace('#', '');\n          var lineStyle = borders.all.lineStyle;\n          /* tslint:disable-next-line:max-line-length */\n          bordersStyle += '<border><left style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></left><right style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></right><top style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></top><bottom style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></bottom></border>';\n        } else {\n          /* tslint:disable-next-line:max-line-length */\n          bordersStyle += '<border><left style=\"' + borders.left.lineStyle + '\"><color rgb=\"FF' + borders.left.color.replace('#', '') + '\" /></left><right style=\"' + borders.right.lineStyle + '\"><color rgb=\"FF' + borders.right.color.replace('#', '') + '\" /></right><top style=\"' + borders.top.lineStyle + '\"><color rgb=\"FF' + borders.top.color.replace('#', '') + '\" /></top><bottom style=\"' + borders.bottom.lineStyle + '\"><color rgb=\"FF' + borders.bottom.color.replace('#', '') + '\" /></bottom></border>';\n        }\n      }\n    }\n    return bordersStyle + '</borders>';\n  };\n  Workbook.prototype.saveCellStyles = function () {\n    var _this = this;\n    var cellStyleString = '<cellStyles  count=\"' + this.cellStyles.size + '\">';\n    this.cellStyles.forEach(function (value, key) {\n      cellStyleString += '<cellStyle name=\"' + key + '\" xfId=\"' + _this.cellStyles.get(key).xfId + '\"';\n      if (key === 'Normal') {\n        cellStyleString += ' builtinId=\"0\"';\n      }\n      cellStyleString += ' />';\n    });\n    return cellStyleString += '</cellStyles>';\n  };\n  Workbook.prototype.saveCellStyleXfs = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var cellXfsStyle = '<cellStyleXfs count=\"' + (this.mCellStyleXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" />';\n    if (this.mCellStyleXfs.length >= 1) {\n      for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\n        var cellStyleXf = _a[_i];\n        /* tslint:disable-next-line:max-line-length */\n        cellXfsStyle += '<xf numFmtId=\"' + cellStyleXf.numFmtId + '\" fontId=\"' + cellStyleXf.fontId + '\" fillId=\"' + cellStyleXf.fillId + '\" borderId=\"' + cellStyleXf.borderId + '\" ';\n        if (cellStyleXf.alignment !== undefined) {\n          cellXfsStyle += '>' + this.saveAlignment(cellStyleXf) + '</xf>';\n        } else {\n          cellXfsStyle += ' />';\n        }\n      }\n    }\n    return cellXfsStyle + '</cellStyleXfs>';\n  };\n  Workbook.prototype.saveCellXfs = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var cellXfsStyle = '<cellXfs count=\"' + (this.mCellXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\" />';\n    if (this.mCellXfs.length >= 1) {\n      for (var _i = 0, _a = this.mCellXfs; _i < _a.length; _i++) {\n        var cellXf = _a[_i];\n        /* tslint:disable-next-line:max-line-length */\n        cellXfsStyle += '<xf numFmtId=\"' + cellXf.numFmtId + '\" fontId=\"' + cellXf.fontId + '\" fillId=\"' + cellXf.fillId + '\" borderId=\"' + cellXf.borderId + '\" xfId=\"' + cellXf.xfId + '\" ';\n        if (cellXf.applyAlignment === 1) {\n          cellXfsStyle += 'applyAlignment=\"1\"';\n        }\n        cellXfsStyle += '>' + this.saveAlignment(cellXf) + '</xf>';\n      }\n    }\n    return cellXfsStyle + '</cellXfs>';\n  };\n  Workbook.prototype.saveAlignment = function (cellXf) {\n    var alignString = '<alignment ';\n    if (cellXf.alignment.horizontal !== undefined) {\n      alignString += 'horizontal=\"' + cellXf.alignment.horizontal + '\" ';\n    }\n    if (cellXf.alignment.indent !== undefined && cellXf.alignment.indent !== 0) {\n      alignString += 'indent=\"' + cellXf.alignment.indent + '\" ';\n    } else if (cellXf.alignment.rotation !== undefined && cellXf.alignment.rotation !== 0) {\n      alignString += 'textRotation=\"' + cellXf.alignment.rotation + '\" ';\n    }\n    if (cellXf.alignment.vertical !== undefined) {\n      alignString += 'vertical=\"' + cellXf.alignment.vertical + '\" ';\n    }\n    alignString += 'wrapText=\"' + cellXf.alignment.wrapText + '\" />';\n    return alignString;\n  };\n  Workbook.prototype.saveApp = function (builtInProperties) {\n    /* tslint:disable-next-line:max-line-length */\n    var appString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Properties xmlns=\"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties\"><Application>Essential XlsIO</Application>';\n    if (builtInProperties !== undefined) {\n      if (builtInProperties.manager !== undefined) {\n        appString += '<Manager>' + builtInProperties.manager + '</Manager>';\n      }\n      if (builtInProperties.company !== undefined) {\n        appString += '<Company>' + builtInProperties.company + '</Company>';\n      }\n    }\n    this.addToArchive(appString + '</Properties>', 'docProps/app.xml');\n  };\n  Workbook.prototype.saveCore = function (builtInProperties) {\n    var createdDate = new Date();\n    /* tslint:disable-next-line:max-line-length */\n    var coreString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><cp:coreProperties xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns:dcmitype=\"http://purl.org/dc/dcmitype/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:cp=\"http://schemas.openxmlformats.org/package/2006/metadata/core-properties\">';\n    if (this.builtInProperties !== undefined) {\n      if (builtInProperties.author !== undefined) {\n        coreString += '<dc:creator>' + builtInProperties.author + '</dc:creator>';\n      }\n      if (builtInProperties.subject !== undefined) {\n        coreString += '<dc:subject>' + builtInProperties.subject + '</dc:subject>';\n      }\n      if (builtInProperties.category !== undefined) {\n        coreString += '<cp:category>' + builtInProperties.category + '</cp:category>';\n      }\n      if (builtInProperties.comments !== undefined) {\n        coreString += '<dc:description>' + builtInProperties.comments + '</dc:description>';\n      }\n      if (builtInProperties.title !== undefined) {\n        coreString += '<dc:title>' + builtInProperties.title + '</dc:title>';\n      }\n      if (builtInProperties.tags !== undefined) {\n        coreString += '<cp:keywords>' + builtInProperties.tags + '</cp:keywords>';\n      }\n      if (builtInProperties.status !== undefined) {\n        coreString += '<cp:contentStatus>' + builtInProperties.status + '</cp:contentStatus>';\n      }\n      if (builtInProperties.createdDate !== undefined) {\n        /* tslint:disable-next-line:max-line-length */\n        coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.createdDate.toISOString() + '</dcterms:created>';\n      } else {\n        coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\n      }\n      if (builtInProperties.modifiedDate !== undefined) {\n        /* tslint:disable-next-line:max-line-length */\n        coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.modifiedDate.toISOString() + '</dcterms:modified>';\n      } else {\n        coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\n      }\n    } else {\n      coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\n      coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\n    }\n    /* tslint:disable-next-line:max-line-length */\n    coreString += '</cp:coreProperties>';\n    this.addToArchive(coreString, 'docProps/core.xml');\n  };\n  Workbook.prototype.saveTopLevelRelation = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var topRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\"><Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\" Target=\"xl/workbook.xml\" /><Relationship Id=\"rId2\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties\" Target=\"docProps/app.xml\" /><Relationship Id=\"rId3\" Type=\"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\" Target=\"docProps/core.xml\" /></Relationships>';\n    this.addToArchive(topRelation, '_rels/.rels');\n  };\n  Workbook.prototype.saveWorkbookRelation = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var wbRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n    var length = this.worksheets.length;\n    var count = 0;\n    for (var i = 0; i < length; i++, count++) {\n      /* tslint:disable-next-line:max-line-length */\n      wbRelation += '<Relationship Id=\"rId' + (i + 1).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet\" Target=\"worksheets/sheet' + (i + 1).toString() + '.xml\" />';\n    }\n    /* tslint:disable-next-line:max-line-length */\n    wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\" Target=\"styles.xml\" />';\n    if (this.sharedStringCount > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings\" Target=\"sharedStrings.xml\" />';\n    }\n    this.addToArchive(wbRelation + '</Relationships>', 'xl/_rels/workbook.xml.rels');\n  };\n  Workbook.prototype.saveContentType = function () {\n    /* tslint:disable-next-line:max-line-length */\n    var contentTypeString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\"><Default Extension=\"xml\" ContentType=\"application/xml\" /><Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\" /><Override PartName=\"/xl/styles.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\" /><Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\" /><Override PartName=\"/docProps/app.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.extended-properties+xml\" /><Override PartName=\"/docProps/core.xml\" ContentType=\"application/vnd.openxmlformats-package.core-properties+xml\" />';\n    var sheetsOverride = '';\n    var length = this.worksheets.length;\n    var drawingIndex = 0;\n    for (var i = 0; i < length; i++) {\n      /* tslint:disable-next-line:max-line-length */\n      sheetsOverride += '<Override PartName=\"/xl/worksheets/sheet' + (i + 1).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\" />';\n      if (this.worksheets[i].images != undefined && this.worksheets[i].images.length > 0) {\n        drawingIndex++;\n        /* tslint:disable-next-line:max-line-length */\n        sheetsOverride += '<Override PartName=\"/xl/drawings/drawing' + drawingIndex.toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.drawing+xml\" />';\n      }\n    }\n    if (this.imageCount > 0) sheetsOverride += '<Default Extension=\"png\" ContentType=\"image/png\" />';\n    if (this.sharedStringCount > 0) {\n      /* tslint:disable-next-line:max-line-length */\n      contentTypeString += '<Override PartName=\"/xl/sharedStrings.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml\" />';\n    }\n    this.addToArchive(contentTypeString + sheetsOverride + '</Types>', '[Content_Types].xml');\n  };\n  Workbook.prototype.addToArchive = function (xmlString, itemName) {\n    if (typeof xmlString === 'string') {\n      var blob = new Blob([xmlString], {\n        type: 'text/plain'\n      });\n      var archiveItem = new ZipArchiveItem(blob, itemName);\n      this.mArchive.addItem(archiveItem);\n    } else {\n      var archiveItem = new ZipArchiveItem(xmlString, itemName);\n      this.mArchive.addItem(archiveItem);\n    }\n  };\n  Workbook.prototype.processMergeCells = function (cell, rowIndex, mergeCells) {\n    if (cell.rowSpan !== 0 || cell.colSpan !== 0) {\n      var mCell = new MergeCell();\n      mCell.x = cell.index;\n      mCell.width = cell.colSpan;\n      mCell.y = rowIndex;\n      mCell.height = cell.rowSpan;\n      var startCell = this.getCellName(mCell.y, mCell.x);\n      var endCell = this.getCellName(rowIndex + mCell.height, cell.index + mCell.width);\n      mCell.ref = startCell + ':' + endCell;\n      var mergedCell = mergeCells.add(mCell);\n      var start = {\n        x: mCell.x,\n        y: mCell.y\n      };\n      var end = {\n        x: cell.index + mCell.width,\n        y: rowIndex + mCell.height\n      };\n      this.updatedMergedCellStyles(start, end, cell);\n    }\n    return mergeCells;\n  };\n  Workbook.prototype.updatedMergedCellStyles = function (sCell, eCell, cell) {\n    for (var x = sCell.x; x <= eCell.x; x++) {\n      for (var y = sCell.y; y <= eCell.y; y++) {\n        this.mergedCellsStyle.set(this.getCellName(y, x), {\n          x: x,\n          y: y,\n          styleIndex: cell.styleIndex\n        });\n      }\n    }\n  };\n  /**\n   * Returns the tick count corresponding to the given year, month, and day.\n   * @param year number value of year\n   * @param month number value of month\n   * @param day number value of day\n   */\n  Workbook.prototype.dateToTicks = function (year, month, day) {\n    var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\n    var daysToMonth365 = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];\n    var daysToMonth366 = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];\n    if (year >= 1 && year <= 9999 && month >= 1 && month <= 12) {\n      var days = this.isLeapYear(year) ? daysToMonth366 : daysToMonth365;\n      var y = year - 1;\n      var n = y * 365 + (y / 4 | 0) - (y / 100 | 0) + (y / 400 | 0) + days[month - 1] + day - 1;\n      return n * ticksPerDay;\n    }\n    throw new Error('Not a valid date');\n  };\n  /**\n   * Return the tick count corresponding to the given hour, minute, second.\n   * @param hour number value of hour\n   * @param minute number value if minute\n   * @param second number value of second\n   */\n  Workbook.prototype.timeToTicks = function (hour, minute, second) {\n    if (hour >= 0 && hour < 24 && minute >= 0 && minute < 60 && second >= 0 && second < 60) {\n      var totalSeconds = hour * 3600 + minute * 60 + second;\n      return totalSeconds * 10000 * 1000;\n    }\n    throw new Error('Not valid time');\n  };\n  /**\n   * Checks if given year is a leap year.\n   * @param year Year value.\n   */\n  Workbook.prototype.isLeapYear = function (year) {\n    return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\n  };\n  /**\n   * Converts `DateTime` to the equivalent OLE Automation date.\n   */\n  Workbook.prototype.toOADate = function (date) {\n    var ticks = 0;\n    /* tslint:disable-next-line:max-line-length */\n    ticks = this.dateToTicks(date.getFullYear(), date.getMonth() + 1, date.getDate()) + this.timeToTicks(date.getHours(), date.getMinutes(), date.getSeconds());\n    if (ticks === 0) {\n      return 0.0;\n    }\n    var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\n    var daysTo1899 = (((365 * 4 + 1) * 25 - 1) * 4 + 1) * 4 + ((365 * 4 + 1) * 25 - 1) * 3 - 367;\n    var doubleDateOffset = daysTo1899 * ticksPerDay;\n    var oaDateMinAsTicks = ((365 * 4 + 1) * 25 - 1 - 365) * ticksPerDay;\n    if (ticks < oaDateMinAsTicks) {\n      throw new Error('Arg_OleAutDateInvalid');\n    }\n    var millisPerDay = 1000 * 60 * 60 * 24;\n    return (ticks - doubleDateOffset) / 10000 / millisPerDay;\n  };\n  return Workbook;\n}();\nexport { Workbook };\n/**\n * BuiltInProperties Class\n * @private\n */\nvar BuiltInProperties = /** @class */function () {\n  function BuiltInProperties() {}\n  return BuiltInProperties;\n}();\nexport { BuiltInProperties };","map":{"version":3,"names":["Worksheets","Worksheet","FreezePane","MergeCell","MergeCells","HyperLink","Grouping","CellStyle","Font","Borders","CellXfs","Alignment","NumFmt","CellStyleXfs","CellStyles","Column","Row","Rows","Image","Cell","Cells","ZipArchive","ZipArchiveItem","CsvHelper","Internationalization","isNullOrUndefined","BlobHelper","AutoFilters","Workbook","json","saveType","culture","currencyString","separator","sharedStringCount","unitsProportions","hyperlinkStyle","fontColor","underline","undefined","currency","intl","mSaveType","mArchive","sharedString","mFonts","mBorders","mStyles","printTitles","Map","cellStyles","mNumFmt","mFills","push","set","mCellXfs","mCellStyleXfs","drawingCount","imageCount","styles","globalStyles","i","length","name","has","cellStyle","isGlobalStyle","parserCellStyle","cellStylesIn","xfId","index","tFormat","numberFormat","format","type","Error","worksheets","parserWorksheets","builtInProperties","BuiltInProperties","parserBuiltInProperties","csvHelper","prototype","jsonBuiltInProperties","author","comments","category","company","manager","subject","title","createdDate","modifiedDate","tags","status","jsonSheet","sheet","mergeCells","mergedCellsStyle","mHyperLinks","toString","enableRtl","columns","parserColumns","rows","parserRows","showGridLines","freeze","parserFreezePanes","printTitle","parserPrintTitle","pageSetup","isSummaryRowBelow","images","parserImages","autoFilters","parseFilters","hyperLinks","mergeOptions","fromJson","toJson","result","applyProperties","sourceJson","destJson","keys","Object","getCellName","row","column","getColumnName","col","strColumnName","iCurrentDigit","String","fromCharCode","printTitleName","titleRowName","fromRow","toRow","titleColName","fromColumn","toColumn","freezePanes","leftCell","columnsLength","width","rowsLength","rowId","r","parserRow","add","insertMergedCellsStyle","_this","forEach","value","key","filter","item","y","cell","cells","x","styleIndex","insertIndex","indexOf","splice","createCell","rowToInsert","cellToInsert","refName","rowIndex","height","grouping","parseGrouping","parseCells","outlineLevel","isCollapsed","isHidden","cellsLength","spanMin","spanMax","curCellIndex","cellId","jsonCell","rowSpan","colSpan","hyperlink","hyperLink","target","displayText","getCellValueType","ref","rId","style","formula","Date","parseCellType","processMergeCells","spans","GetColors","colors","processColor","colorVal","replace","toUpperCase","rgbColors","get","processCellValue","cellValue","processedVal","startindex","endIndex","processString","substring","subString","text","subSplit","split","_i","subSplit_1","element","start","trim","applyGlobalStyle","a","cellType","defStyleIndex","backColor","borders","parserBorder","all","leftBorder","left","rightBorder","right","topBorder","top","bottomBorder","bottom","fontName","fontSize","italic","bold","hAlign","toLowerCase","indent","rotation","vAlign","strikeThrough","wrapText","getNumberFormat","numFmtId","processCellStyle","switchNumberFormat","numFmt","formatCode","_a","cellStyleXfs","_b","_c","cellXfs","changeNumberFormats","regex","RegExp","returnFormat","getNumberPattern","useGrouping","error","getDatePattern","skeleton","border","color","lineStyle","processNumFormatId","compareResult","compareStyle","id","size","isNewFont","toCompareStyle","font","b","u","strike","sz","isNewBorder","bStyle","isAllBorder","toCompareBorder","allBorderStyle","globalStyleIndex","baseStyle","contains","array","toOADate","value_1","sstvalue","imagesLength","imageId","p","image","parserImage","lastRow","lastColumn","horizontalFlip","verticalFlip","saveAsBlob","blobSaveType","encodingType","Promise","resolve","reject","obj","blobData","saveInternal","then","blob","Blob","save","fileName","proxyUrl","xlsxMatch","match","csvMatch","destroy","saveWorkbook","saveWorksheets","saveSharedString","saveStyles","saveApp","saveCore","saveContentType","saveTopLevelRelation","saveWorkbookRelation","workbookTemp","sheets","sheetName","printTitle_1","addToArchive","saveWorksheet","sheetBlob","sheetString","saveSheetView","colString","pixelsToColumnWidth","append","rowString","pixelsToRowHeight","_d","_e","_f","_g","mCell","_h","_j","hLink","saveDrawings","saveSheetRelations","getBlob","drawings","sheetDrawingString","imgId","pic","updatelastRowOffset","updatelastColumnOffSet","lastRowOffset","lastColOffset","imageFile","imageData","convertBase64toImage","saveDrawingRelations","picture","iCurHeight","iCurRow","iCurOffset","iRowHeight","convertToPixels","iSpaceInCell","rowHiddenHeight","Math","round","iCurWidth","iCurCol","iColWidth","ColumnWidthToPixels","colHiddenWidth","img","byteStr","window","atob","buffer","ArrayBuffer","data","Uint8Array","charCodeAt","drawingRelation","pixels","dDigitWidth","val","trunc","fileWidth","n","relStr","paneString","sstStart","si","updateCellXfsStyleXfs","styleTemp","saveNumberFormats","saveFonts","saveFills","saveBorders","saveCellStyleXfs","saveCellXfs","saveCellStyles","compareFontResult","fontId","fillId","borderId","applyAlignment","alignment","horizontal","vertical","numFmtStyle_1","fontStyle","fillsStyle","bordersStyle","cellStyleString","cellXfsStyle","cellStyleXf","saveAlignment","cellXf","alignString","appString","coreString","toISOString","topRelation","wbRelation","count","contentTypeString","sheetsOverride","drawingIndex","xmlString","itemName","archiveItem","addItem","startCell","endCell","mergedCell","end","updatedMergedCellStyles","sCell","eCell","dateToTicks","year","month","day","ticksPerDay","daysToMonth365","daysToMonth366","days","isLeapYear","timeToTicks","hour","minute","second","totalSeconds","date","ticks","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","daysTo1899","doubleDateOffset","oaDateMinAsTicks","millisPerDay"],"sources":["/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/node_modules/@syncfusion/ej2-excel-export/src/workbook.js"],"sourcesContent":["import { Worksheets } from './worksheets';\nimport { Worksheet, FreezePane, MergeCell, MergeCells, HyperLink, Grouping } from './worksheet';\nimport { CellStyle, Font, Borders, CellXfs, Alignment, NumFmt, CellStyleXfs, CellStyles } from './cell-style';\nimport { Column } from './column';\nimport { Row, Rows } from './row';\nimport { Image } from './image';\nimport { Cell, Cells } from './cell';\nimport { ZipArchive, ZipArchiveItem } from '@syncfusion/ej2-compression';\nimport { CsvHelper } from './csv-helper';\nimport { Internationalization, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { BlobHelper } from './blob-helper';\nimport { AutoFilters } from './auto-filters';\n/**\n * Workbook class\n */\nvar Workbook = /** @class */ (function () {\n    /* tslint:disable:no-any */\n    function Workbook(json, saveType, culture, currencyString, separator) {\n        this.sharedStringCount = 0;\n        this.unitsProportions = [\n            96 / 75.0,\n            96 / 300.0,\n            96,\n            96 / 25.4,\n            96 / 2.54,\n            1,\n            96 / 72.0,\n            96 / 72.0 / 12700,\n        ];\n        /* tslint:disable:no-any */\n        this.hyperlinkStyle = { fontColor: '#0000FF', underline: true };\n        if (culture !== undefined) {\n            this.culture = culture;\n        }\n        else {\n            this.culture = 'en-US';\n        }\n        if (currencyString !== undefined) {\n            this.currency = currencyString;\n        }\n        else {\n            this.currency = 'USD';\n        }\n        this.intl = new Internationalization(this.culture);\n        this.mSaveType = saveType;\n        if (saveType === 'xlsx') {\n            this.mArchive = new ZipArchive();\n            this.sharedString = [];\n            this.mFonts = [];\n            this.mBorders = [];\n            this.mStyles = [];\n            this.printTitles = new Map();\n            this.cellStyles = new Map();\n            this.mNumFmt = new Map();\n            this.mFills = new Map();\n            this.mStyles.push(new CellStyle());\n            this.mFonts.push(new Font());\n            /* tslint:disable */\n            this.cellStyles.set('Normal', new CellStyles());\n            /* tslint:enable */\n            this.mCellXfs = [];\n            this.mCellStyleXfs = [];\n            this.drawingCount = 0;\n            this.imageCount = 0;\n            if (json.styles !== null && json.styles !== undefined) {\n                /* tslint:disable-next-line:no-any */\n                this.globalStyles = new Map();\n                for (var i = 0; i < json.styles.length; i++) {\n                    if (json.styles[i].name !== undefined) {\n                        if (!this.cellStyles.has(json.styles[i].name)) {\n                            var cellStyle = new CellStyle();\n                            cellStyle.isGlobalStyle = true;\n                            this.parserCellStyle(json.styles[i], cellStyle, 'none');\n                            var cellStylesIn = new CellStyles();\n                            cellStylesIn.name = cellStyle.name;\n                            cellStylesIn.xfId = (cellStyle.index - 1);\n                            this.cellStyles.set(cellStylesIn.name, cellStylesIn);\n                            /* tslint:disable-next-line:no-any */\n                            var tFormat = {};\n                            if (json.styles[i].numberFormat !== undefined) {\n                                tFormat.format = json.styles[i].numberFormat;\n                            }\n                            if (json.styles[i].type !== undefined) {\n                                tFormat.type = json.styles[i].type;\n                            }\n                            else {\n                                tFormat.type = 'datetime';\n                            }\n                            if (tFormat.format !== undefined) {\n                                this.globalStyles.set(json.styles[i].name, tFormat);\n                            }\n                        }\n                        else {\n                            throw Error('Style name ' + json.styles[i].name + ' is already existed');\n                        }\n                    }\n                }\n            }\n            // Parses Worksheets data to DOM.        \n            if (json.worksheets !== null && json.worksheets !== undefined) {\n                this.parserWorksheets(json.worksheets);\n            }\n            else {\n                throw Error('Worksheet is expected.');\n            }\n            // Parses the BuiltInProperties data to DOM.        \n            if (json.builtInProperties !== null && json.builtInProperties !== undefined) {\n                this.builtInProperties = new BuiltInProperties();\n                this.parserBuiltInProperties(json.builtInProperties, this.builtInProperties);\n            }\n        }\n        else {\n            this.csvHelper = new CsvHelper(json, separator);\n        }\n    }\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserBuiltInProperties = function (jsonBuiltInProperties, builtInProperties) {\n        //Author\n        if (jsonBuiltInProperties.author !== null && jsonBuiltInProperties.author !== undefined) {\n            builtInProperties.author = jsonBuiltInProperties.author;\n        }\n        //Comments\n        if (jsonBuiltInProperties.comments !== null && jsonBuiltInProperties.comments !== undefined) {\n            builtInProperties.comments = jsonBuiltInProperties.comments;\n        }\n        //Category\n        if (jsonBuiltInProperties.category !== null && jsonBuiltInProperties.category !== undefined) {\n            builtInProperties.category = jsonBuiltInProperties.category;\n        }\n        //Company\n        if (jsonBuiltInProperties.company !== null && jsonBuiltInProperties.company !== undefined) {\n            builtInProperties.company = jsonBuiltInProperties.company;\n        }\n        //Manager\n        if (jsonBuiltInProperties.manager !== null && jsonBuiltInProperties.manager !== undefined) {\n            builtInProperties.manager = jsonBuiltInProperties.manager;\n        }\n        //Subject\n        if (jsonBuiltInProperties.subject !== null && jsonBuiltInProperties.subject !== undefined) {\n            builtInProperties.subject = jsonBuiltInProperties.subject;\n        }\n        //Title\n        if (jsonBuiltInProperties.title !== null && jsonBuiltInProperties.title !== undefined) {\n            builtInProperties.title = jsonBuiltInProperties.title;\n        }\n        //Creation date\n        if (jsonBuiltInProperties.createdDate !== null && jsonBuiltInProperties.createdDate !== undefined) {\n            builtInProperties.createdDate = jsonBuiltInProperties.createdDate;\n        }\n        //Modified date\n        if (jsonBuiltInProperties.modifiedDate !== null && jsonBuiltInProperties.modifiedDate !== undefined) {\n            builtInProperties.modifiedDate = jsonBuiltInProperties.modifiedDate;\n        }\n        //Tags\n        if (jsonBuiltInProperties.tags !== null && jsonBuiltInProperties.tags !== undefined) {\n            builtInProperties.tags = jsonBuiltInProperties.tags;\n        }\n        //Status\n        if (jsonBuiltInProperties.status !== null && jsonBuiltInProperties.status !== undefined) {\n            builtInProperties.status = jsonBuiltInProperties.status;\n        }\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserWorksheets = function (json) {\n        this.worksheets = new Worksheets();\n        var length = json.length;\n        for (var i = 0; i < length; i++) {\n            var jsonSheet = json[i];\n            var sheet = new Worksheet();\n            this.mergeCells = new MergeCells();\n            this.mergedCellsStyle = new Map();\n            this.mHyperLinks = [];\n            //Name\n            if (jsonSheet.name !== null && jsonSheet.name !== undefined) {\n                sheet.name = jsonSheet.name;\n            }\n            else {\n                sheet.name = 'Sheet' + (i + 1).toString();\n            }\n            if (jsonSheet.enableRtl !== null && jsonSheet.enableRtl !== undefined) {\n                sheet.enableRtl = jsonSheet.enableRtl;\n            }\n            sheet.index = (i + 1);\n            //Columns\n            if (jsonSheet.columns !== null && jsonSheet.columns !== undefined) {\n                this.parserColumns(jsonSheet.columns, sheet);\n            }\n            //Rows\n            if (jsonSheet.rows !== null && jsonSheet.rows !== undefined) {\n                this.parserRows(jsonSheet.rows, sheet);\n            }\n            //showGridLines\n            if (jsonSheet.showGridLines !== null && jsonSheet.showGridLines !== undefined) {\n                sheet.showGridLines = jsonSheet.showGridLines;\n            }\n            //FreezePanes\n            if (jsonSheet.freeze !== null && jsonSheet.freeze !== undefined) {\n                this.parserFreezePanes(jsonSheet.freeze, sheet);\n            }\n            //Print Title\n            if (jsonSheet.printTitle !== null && jsonSheet.printTitle !== undefined) {\n                this.parserPrintTitle(jsonSheet.printTitle, sheet);\n            }\n            if (jsonSheet.pageSetup !== undefined) {\n                if (jsonSheet.pageSetup.isSummaryRowBelow !== undefined) {\n                    sheet.isSummaryRowBelow = jsonSheet.pageSetup.isSummaryRowBelow;\n                }\n            }\n            if (jsonSheet.images !== undefined) {\n                this.parserImages(jsonSheet.images, sheet);\n            }\n            if (jsonSheet.autoFilters !== null && jsonSheet.autoFilters !== undefined) {\n                this.parseFilters(jsonSheet.autoFilters, sheet);\n            }\n            sheet.index = (i + 1);\n            sheet.mergeCells = this.mergeCells;\n            sheet.hyperLinks = this.mHyperLinks;\n            this.worksheets.push(sheet);\n        }\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.mergeOptions = function (fromJson, toJson) {\n        /* tslint:disable:no-any */\n        var result = {};\n        this.applyProperties(fromJson, result);\n        this.applyProperties(toJson, result);\n        return result;\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.applyProperties = function (sourceJson, destJson) {\n        var keys = Object.keys(sourceJson);\n        for (var index = 0; index < keys.length; index++) {\n            if (keys[index] !== 'name') {\n                destJson[keys[index]] = sourceJson[keys[index]];\n            }\n        }\n    };\n    Workbook.prototype.getCellName = function (row, column) {\n        return this.getColumnName(column) + row.toString();\n    };\n    Workbook.prototype.getColumnName = function (col) {\n        col--;\n        var strColumnName = '';\n        do {\n            var iCurrentDigit = col % 26;\n            col = col / 26 - 1;\n            strColumnName = String.fromCharCode(65 + iCurrentDigit) + strColumnName;\n        } while (col >= 0);\n        return strColumnName;\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserPrintTitle = function (json, sheet) {\n        var printTitleName = '';\n        var titleRowName;\n        if (json.fromRow !== null && json.fromRow !== undefined) {\n            var fromRow = json.fromRow;\n            var toRow = void 0;\n            if (json.toRow !== null && json.toRow !== undefined) {\n                toRow = json.toRow;\n            }\n            else {\n                toRow = json.fromRow;\n            }\n            titleRowName = '$' + fromRow + ':$' + toRow;\n        }\n        var titleColName;\n        if (json.fromColumn !== null && json.fromColumn !== undefined) {\n            var fromColumn = json.fromColumn;\n            var toColumn = void 0;\n            if (json.toColumn !== null && json.toColumn !== undefined) {\n                toColumn = json.toColumn;\n            }\n            else {\n                toColumn = json.fromColumn;\n            }\n            titleColName = '$' + this.getColumnName(fromColumn) + ':$' + this.getColumnName(toColumn);\n        }\n        if (titleRowName !== undefined) {\n            printTitleName += (sheet.name + '!' + titleRowName);\n        }\n        if (titleColName !== undefined && titleRowName !== undefined) {\n            printTitleName += ',' + (sheet.name + '!' + titleColName);\n        }\n        else if (titleColName !== undefined) {\n            printTitleName += (sheet.name + '!' + titleColName);\n        }\n        if (printTitleName !== '') {\n            this.printTitles.set(sheet.index - 1, printTitleName);\n        }\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserFreezePanes = function (json, sheet) {\n        sheet.freezePanes = new FreezePane();\n        if (json.row !== null && json.row !== undefined) {\n            sheet.freezePanes.row = json.row;\n        }\n        else {\n            sheet.freezePanes.row = 0;\n        }\n        if (json.column !== null && json.column !== undefined) {\n            sheet.freezePanes.column = json.column;\n        }\n        else {\n            sheet.freezePanes.column = 0;\n        }\n        sheet.freezePanes.leftCell = this.getCellName(sheet.freezePanes.row + 1, sheet.freezePanes.column + 1);\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserColumns = function (json, sheet) {\n        var columnsLength = json.length;\n        sheet.columns = [];\n        for (var column = 0; column < columnsLength; column++) {\n            var col = new Column();\n            if (json[column].index !== null && json[column].index !== undefined) {\n                col.index = json[column].index;\n            }\n            else {\n                throw Error('Column index is missing.');\n            }\n            if (json[column].width !== null && json[column].width !== undefined) {\n                col.width = json[column].width;\n            }\n            sheet.columns.push(col);\n        }\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserRows = function (json, sheet) {\n        var rowsLength = json.length;\n        sheet.rows = new Rows();\n        var rowId = 0;\n        for (var r = 0; r < rowsLength; r++) {\n            var row = this.parserRow(json[r], rowId);\n            rowId = row.index;\n            sheet.rows.add(row);\n        }\n        this.insertMergedCellsStyle(sheet);\n    };\n    Workbook.prototype.insertMergedCellsStyle = function (sheet) {\n        var _this = this;\n        if (this.mergeCells.length > 0) {\n            this.mergedCellsStyle.forEach(function (value, key) {\n                var row = sheet.rows.filter(function (item) {\n                    return item.index === value.y;\n                })[0];\n                if (!isNullOrUndefined(row)) {\n                    var cell = row.cells.filter(function (item) {\n                        return item.index === value.x;\n                    })[0];\n                    if (!isNullOrUndefined(cell)) {\n                        cell.styleIndex = value.styleIndex;\n                    }\n                    else {\n                        var cells = row.cells.filter(function (item) {\n                            return item.index <= value.x;\n                        });\n                        var insertIndex = 0;\n                        if (cells.length > 0) {\n                            insertIndex = row.cells.indexOf(cells[cells.length - 1]) + 1;\n                        }\n                        row.cells.splice(insertIndex, 0, _this.createCell(value, key));\n                    }\n                }\n                else {\n                    var rows = sheet.rows.filter(function (item) {\n                        return item.index <= value.y;\n                    });\n                    var rowToInsert = new Row();\n                    rowToInsert.index = value.y;\n                    rowToInsert.cells = new Cells();\n                    rowToInsert.cells.add(_this.createCell(value, key));\n                    var insertIndex = 0;\n                    if (rows.length > 0) {\n                        insertIndex = sheet.rows.indexOf(rows[rows.length - 1]) + 1;\n                    }\n                    sheet.rows.splice(insertIndex, 0, rowToInsert);\n                }\n            });\n        }\n    };\n    Workbook.prototype.createCell = function (value, key) {\n        var cellToInsert = new Cell();\n        cellToInsert.refName = key;\n        cellToInsert.index = value.x;\n        cellToInsert.cellStyle = new CellStyle();\n        cellToInsert.styleIndex = value.styleIndex;\n        return cellToInsert;\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserRow = function (json, rowIndex) {\n        var row = new Row();\n        //Row Height\n        if (json.height !== null && json.height !== undefined) {\n            row.height = json.height;\n        }\n        //Row index\n        if (json.index !== null && json.index !== undefined) {\n            row.index = json.index;\n        }\n        else {\n            throw Error('Row index is missing.');\n        }\n        if (json.grouping !== null && json.grouping !== undefined) {\n            this.parseGrouping(json.grouping, row);\n        }\n        this.parseCells(json.cells, row);\n        return row;\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parseGrouping = function (json, row) {\n        row.grouping = new Grouping();\n        if (json.outlineLevel !== undefined) {\n            row.grouping.outlineLevel = json.outlineLevel;\n        }\n        if (json.isCollapsed !== undefined) {\n            row.grouping.isCollapsed = json.isCollapsed;\n        }\n        if (json.isHidden !== undefined) {\n            row.grouping.isHidden = json.isHidden;\n        }\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parseCells = function (json, row) {\n        row.cells = new Cells();\n        var cellsLength = json !== undefined ? json.length : 0;\n        var spanMin = 1;\n        var spanMax = 1;\n        var curCellIndex = 0;\n        for (var cellId = 0; cellId < cellsLength; cellId++) {\n            /* tslint:disable:no-any */\n            var jsonCell = json[cellId];\n            var cell = new Cell();\n            //cell index\n            if (jsonCell.index !== null && jsonCell.index !== undefined) {\n                cell.index = jsonCell.index;\n            }\n            else {\n                throw Error('Cell index is missing.');\n            }\n            if (cell.index < spanMin) {\n                spanMin = cell.index;\n            }\n            else if (cell.index > spanMax) {\n                spanMax = cell.index;\n            }\n            //Update the Cell name\n            cell.refName = this.getCellName(row.index, cell.index);\n            //Row span\n            if (jsonCell.rowSpan !== null && jsonCell.rowSpan !== undefined) {\n                cell.rowSpan = jsonCell.rowSpan - 1;\n            }\n            else {\n                cell.rowSpan = 0;\n            }\n            //Column span\n            if (jsonCell.colSpan !== null && jsonCell.colSpan !== undefined) {\n                cell.colSpan = jsonCell.colSpan - 1;\n            }\n            else {\n                cell.colSpan = 0;\n            }\n            //Hyperlink\n            if (jsonCell.hyperlink !== null && jsonCell.hyperlink !== undefined) {\n                var hyperLink = new HyperLink();\n                if (jsonCell.hyperlink.target !== undefined) {\n                    hyperLink.target = jsonCell.hyperlink.target;\n                    if (jsonCell.hyperlink.displayText !== undefined) {\n                        cell.value = jsonCell.hyperlink.displayText;\n                    }\n                    else {\n                        cell.value = jsonCell.hyperlink.target;\n                    }\n                    cell.type = this.getCellValueType(cell.value);\n                    hyperLink.ref = cell.refName;\n                    hyperLink.rId = (this.mHyperLinks.length + 1);\n                    this.mHyperLinks.push(hyperLink);\n                    cell.cellStyle = new CellStyle();\n                    /* tslint:disable-next-line:max-line-length */\n                    this.parserCellStyle((jsonCell.style !== undefined ? this.mergeOptions(jsonCell.style, this.hyperlinkStyle) : this.hyperlinkStyle), cell.cellStyle, 'string');\n                    cell.styleIndex = cell.cellStyle.index;\n                }\n            }\n            // formulas\n            if (jsonCell.formula !== null && jsonCell.formula !== undefined) {\n                cell.formula = jsonCell.formula;\n                cell.type = 'formula';\n            }\n            //Cell value\n            if (jsonCell.value !== null && jsonCell.value !== undefined) {\n                if (cell.formula !== undefined) {\n                    cell.value = 0;\n                }\n                else {\n                    cell.value = jsonCell.value;\n                    cell.type = this.getCellValueType(cell.value);\n                }\n            }\n            if (jsonCell.style !== null && jsonCell.style !== undefined && cell.styleIndex === undefined) {\n                cell.cellStyle = new CellStyle();\n                if (cell.value instanceof Date) {\n                    this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type, 14);\n                }\n                else {\n                    this.parserCellStyle(jsonCell.style, cell.cellStyle, cell.type);\n                }\n                cell.styleIndex = cell.cellStyle.index;\n            }\n            else if (cell.value instanceof Date) {\n                cell.cellStyle = new CellStyle();\n                this.parserCellStyle({}, cell.cellStyle, cell.type, 14);\n                cell.styleIndex = cell.cellStyle.index;\n            }\n            this.parseCellType(cell);\n            this.mergeCells = this.processMergeCells(cell, row.index, this.mergeCells);\n            row.cells.add(cell);\n            curCellIndex = (cell.index + 1);\n        }\n        row.spans = (spanMin) + ':' + (spanMax);\n    };\n    Workbook.prototype.GetColors = function () {\n        var colors;\n        colors = new Map();\n        /* tslint:disable */\n        colors.set('WHITE', 'FFFFFFFF');\n        /* tslint:disable */\n        colors.set('SILVER', 'FFC0C0C0');\n        /* tslint:disable */\n        colors.set('GRAY', 'FF808080');\n        /* tslint:disable */\n        colors.set('BLACK', 'FF000000');\n        /* tslint:disable */\n        colors.set('RED', 'FFFF0000');\n        /* tslint:disable */\n        colors.set('MAROON', 'FF800000');\n        /* tslint:disable */\n        colors.set('YELLOW', 'FFFFFF00');\n        /* tslint:disable */\n        colors.set('OLIVE', 'FF808000');\n        /* tslint:disable */\n        colors.set('LIME', 'FF00FF00');\n        /* tslint:disable */\n        colors.set('GREEN', 'FF008000');\n        /* tslint:disable */\n        colors.set('AQUA', 'FF00FFFF');\n        /* tslint:disable */\n        colors.set('TEAL', 'FF008080');\n        /* tslint:disable */\n        colors.set('BLUE', 'FF0000FF');\n        /* tslint:disable */\n        colors.set('NAVY', 'FF000080');\n        /* tslint:disable */\n        colors.set('FUCHSIA', 'FFFF00FF');\n        /* tslint:disable */\n        colors.set('PURPLE', 'FF800080');\n        return colors;\n    };\n    Workbook.prototype.processColor = function (colorVal) {\n        if (colorVal.indexOf('#') === 0) {\n            return colorVal.replace('#', 'FF');\n        }\n        colorVal = colorVal.toUpperCase();\n        this.rgbColors = this.GetColors();\n        if (this.rgbColors.has(colorVal)) {\n            colorVal = this.rgbColors.get(colorVal);\n        }\n        else {\n            colorVal = 'FF000000';\n        }\n        return colorVal;\n    };\n    Workbook.prototype.processCellValue = function (value, cell) {\n        var cellValue = value;\n        if (value.indexOf(\"<font\") !== -1 || value.indexOf(\"<a\") !== -1 || value.indexOf(\"<b>\") !== -1 ||\n            value.indexOf(\"<i>\") !== -1 || value.indexOf(\"<u>\") !== -1) {\n            var processedVal = '';\n            var startindex = value.indexOf('<', 0);\n            var endIndex = value.indexOf('>', startindex + 1);\n            if (startindex >= 0 && endIndex >= 0) {\n                if (startindex !== 0) {\n                    processedVal += '<r><t xml:space=\"preserve\">' + this.processString(value.substring(0, startindex)) + '</t></r>';\n                }\n                while (startindex >= 0 && endIndex >= 0) {\n                    endIndex = value.indexOf('>', startindex + 1);\n                    if (endIndex >= 0) {\n                        var subString = value.substring(startindex + 1, endIndex);\n                        startindex = value.indexOf('<', endIndex + 1);\n                        if (startindex < 0) {\n                            startindex = cellValue.length;\n                        }\n                        var text = cellValue.substring(endIndex + 1, startindex);\n                        if (text.length !== 0) {\n                            var subSplit = subString.split(' ');\n                            if (subSplit.length > 0) {\n                                processedVal += '<r><rPr>';\n                            }\n                            if (subSplit.length > 1) {\n                                for (var _i = 0, subSplit_1 = subSplit; _i < subSplit_1.length; _i++) {\n                                    var element = subSplit_1[_i];\n                                    var start = element.trim().substring(0, 5);\n                                    switch (start) {\n                                        case 'size=':\n                                            processedVal += '<sz val=\"' + element.substring(6, element.length - 1) + '\"/>';\n                                            break;\n                                        case 'face=':\n                                            processedVal += '<rFont val=\"' + element.substring(6, element.length - 1) + '\"/>';\n                                            break;\n                                        case 'color':\n                                            processedVal += '<color rgb=\"' + this.processColor(element.substring(7, element.length - 1)) + '\"/>';\n                                            break;\n                                        case 'href=':\n                                            var hyperLink = new HyperLink();\n                                            hyperLink.target = element.substring(6, element.length - 1).trim();\n                                            hyperLink.ref = cell.refName;\n                                            hyperLink.rId = (this.mHyperLinks.length + 1);\n                                            this.mHyperLinks.push(hyperLink);\n                                            processedVal += '<color rgb=\"FF0000FF\"/><u/><b/>';\n                                            break;\n                                    }\n                                }\n                            }\n                            else if (subSplit.length === 1) {\n                                var style = subSplit[0].trim();\n                                switch (style) {\n                                    case 'b':\n                                        processedVal += '<b/>';\n                                        break;\n                                    case 'i':\n                                        processedVal += '<i/>';\n                                        break;\n                                    case 'u':\n                                        processedVal += '<u/>';\n                                        break;\n                                }\n                            }\n                            processedVal += '</rPr><t xml:space=\"preserve\">' + this.processString(text) + '</t></r>';\n                        }\n                    }\n                }\n                if (processedVal === '') {\n                    return cellValue;\n                }\n                return processedVal;\n            }\n            else {\n                return cellValue;\n            }\n        }\n        else {\n            return cellValue;\n        }\n    };\n    Workbook.prototype.applyGlobalStyle = function (json, cellStyle) {\n        var index = 0;\n        if (this.cellStyles.has(json.name)) {\n            cellStyle.index = this.mStyles.filter(function (a) { return (a.name === json.name); })[0].index;\n            cellStyle.name = json.name;\n        }\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserCellStyle = function (json, cellStyle, cellType, defStyleIndex) {\n        //name\n        if (json.name !== null && json.name !== undefined) {\n            if (cellStyle.isGlobalStyle) {\n                cellStyle.name = json.name;\n            }\n            else {\n                this.applyGlobalStyle(json, cellStyle);\n                return;\n            }\n        }\n        //background color\n        if (json.backColor !== null && json.backColor !== undefined) {\n            cellStyle.backColor = json.backColor;\n        }\n        //borders\n        //leftBorder\n        cellStyle.borders = new Borders();\n        //AllBorder\n        if (json.borders !== null && json.borders !== undefined) {\n            this.parserBorder(json.borders, cellStyle.borders.all);\n        }\n        //leftborder\n        if (json.leftBorder !== null && json.leftBorder !== undefined) {\n            this.parserBorder(json.leftBorder, cellStyle.borders.left);\n        }\n        //rightBorder\n        if (json.rightBorder !== null && json.rightBorder !== undefined) {\n            this.parserBorder(json.rightBorder, cellStyle.borders.right);\n        }\n        //topBorder\n        if (json.topBorder !== null && json.topBorder !== undefined) {\n            this.parserBorder(json.topBorder, cellStyle.borders.top);\n        }\n        //bottomBorder\n        if (json.bottomBorder !== null && json.bottomBorder !== undefined) {\n            this.parserBorder(json.bottomBorder, cellStyle.borders.bottom);\n        }\n        //fontName\n        if (json.fontName !== null && json.fontName !== undefined) {\n            cellStyle.fontName = json.fontName;\n        }\n        //fontSize\n        if (json.fontSize !== null && json.fontSize !== undefined) {\n            cellStyle.fontSize = json.fontSize;\n        }\n        //fontColor\n        if (json.fontColor !== null && json.fontColor !== undefined) {\n            cellStyle.fontColor = json.fontColor;\n        }\n        //italic\n        if (json.italic !== null && json.italic !== undefined) {\n            cellStyle.italic = json.italic;\n        }\n        //bold\n        if (json.bold !== null && json.bold !== undefined) {\n            cellStyle.bold = json.bold;\n        }\n        //hAlign\n        if (json.hAlign !== null && json.hAlign !== undefined) {\n            cellStyle.hAlign = json.hAlign.toLowerCase();\n        }\n        //indent\n        if (json.indent !== null && json.indent !== undefined) {\n            cellStyle.indent = json.indent;\n            if (!(cellStyle.hAlign === 'left' || cellStyle.hAlign === 'right')) {\n                cellStyle.hAlign = 'left';\n            }\n        }\n        if (json.rotation !== null && json.rotation !== undefined) {\n            cellStyle.rotation = json.rotation;\n        }\n        //vAlign\n        if (json.vAlign !== null && json.vAlign !== undefined) {\n            cellStyle.vAlign = json.vAlign.toLowerCase();\n        }\n        //underline\n        if (json.underline !== null && json.underline !== undefined) {\n            cellStyle.underline = json.underline;\n        }\n        //strikeThrough\n        if (json.strikeThrough !== null && json.strikeThrough !== undefined) {\n            cellStyle.strikeThrough = json.strikeThrough;\n        }\n        //wrapText\n        if (json.wrapText !== null && json.wrapText !== undefined) {\n            cellStyle.wrapText = json.wrapText;\n        }\n        //numberFormat\n        if (json.numberFormat !== null && json.numberFormat !== undefined) {\n            if (json.type !== null && json.type !== undefined) {\n                cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, json.type);\n            }\n            else {\n                cellStyle.numberFormat = this.getNumberFormat(json.numberFormat, cellType);\n            }\n        }\n        else if (defStyleIndex !== undefined) {\n            cellStyle.numFmtId = 14;\n            cellStyle.numberFormat = 'GENERAL';\n        }\n        else {\n            cellStyle.numberFormat = 'GENERAL';\n        }\n        cellStyle.index = this.processCellStyle(cellStyle);\n    };\n    Workbook.prototype.switchNumberFormat = function (numberFormat, type) {\n        var format = this.getNumberFormat(numberFormat, type);\n        if (format !== numberFormat) {\n            var numFmt = this.mNumFmt.get(numberFormat);\n            if (numFmt !== undefined) {\n                numFmt.formatCode = format;\n                if (this.mNumFmt.has(format)) {\n                    for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\n                        var cellStyleXfs = _a[_i];\n                        if (cellStyleXfs.numFmtId === numFmt.numFmtId) {\n                            cellStyleXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\n                        }\n                    }\n                    for (var _b = 0, _c = this.mCellXfs; _b < _c.length; _b++) {\n                        var cellXfs = _c[_b];\n                        if (cellXfs.numFmtId === numFmt.numFmtId) {\n                            cellXfs.numFmtId = this.mNumFmt.get(format).numFmtId;\n                        }\n                    }\n                }\n            }\n        }\n    };\n    Workbook.prototype.changeNumberFormats = function (value) {\n        if (typeof value == \"string\") {\n            var regex = new RegExp(this.currency, 'g');\n            value = value.replace(regex, '[$' + this.currency + ']');\n        }\n        else if (typeof value == \"object\") {\n            for (var i = 0; i < value.length; i++) {\n                value[i] = value[i].replace(this.currency, '[$' + this.currency + ']');\n            }\n        }\n        return value;\n    };\n    Workbook.prototype.getNumberFormat = function (numberFormat, type) {\n        var returnFormat;\n        switch (type) {\n            case 'number':\n                try {\n                    returnFormat = this.intl.getNumberPattern({ format: numberFormat, currency: this.currency, useGrouping: true }, true);\n                    if (this.currency.length > 1) {\n                        returnFormat = this.changeNumberFormats(returnFormat);\n                    }\n                }\n                catch (error) {\n                    returnFormat = numberFormat;\n                }\n                break;\n            case 'datetime':\n                try {\n                    returnFormat = this.intl.getDatePattern({ skeleton: numberFormat, type: 'dateTime' }, true);\n                }\n                catch (error) {\n                    try {\n                        returnFormat = this.intl.getDatePattern({ format: numberFormat, type: 'dateTime' }, true);\n                    }\n                    catch (error) {\n                        returnFormat = numberFormat;\n                    }\n                }\n                break;\n            case 'date':\n                try {\n                    returnFormat = this.intl.getDatePattern({ skeleton: numberFormat, type: 'date' }, true);\n                }\n                catch (error) {\n                    try {\n                        returnFormat = this.intl.getDatePattern({ format: numberFormat, type: 'date' }, true);\n                    }\n                    catch (error) {\n                        returnFormat = numberFormat;\n                    }\n                }\n                break;\n            case 'time':\n                try {\n                    returnFormat = this.intl.getDatePattern({ skeleton: numberFormat, type: 'time' }, true);\n                }\n                catch (error) {\n                    try {\n                        returnFormat = this.intl.getDatePattern({ format: numberFormat, type: 'time' }, true);\n                    }\n                    catch (error) {\n                        returnFormat = numberFormat;\n                    }\n                }\n                break;\n            default:\n                returnFormat = numberFormat;\n                break;\n        }\n        return returnFormat;\n    };\n    /* tslint:disable:no-any */\n    Workbook.prototype.parserBorder = function (json, border) {\n        if (json.color !== null && json.color !== undefined) {\n            border.color = json.color;\n        }\n        else {\n            border.color = '#000000';\n        }\n        if (json.lineStyle !== null && json.lineStyle !== undefined) {\n            border.lineStyle = json.lineStyle;\n        }\n        else {\n            border.lineStyle = 'thin';\n        }\n    };\n    Workbook.prototype.processCellStyle = function (style) {\n        if (style.isGlobalStyle) {\n            this.processNumFormatId(style);\n            this.mStyles.push(style);\n            return this.mStyles.length;\n        }\n        else {\n            var compareResult = this.compareStyle(style);\n            if (!compareResult.result) {\n                this.processNumFormatId(style);\n                this.mStyles.push(style);\n                return this.mStyles.length;\n            }\n            else {\n                //Return the index of the already existing style.\n                return compareResult.index;\n            }\n        }\n    };\n    Workbook.prototype.processNumFormatId = function (style) {\n        if (style.numberFormat !== 'GENERAL' && !this.mNumFmt.has(style.numberFormat)) {\n            var id = this.mNumFmt.size + 164;\n            this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\n        }\n    };\n    Workbook.prototype.isNewFont = function (toCompareStyle) {\n        var result = false;\n        var index = 0;\n        for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\n            var font = _a[_i];\n            index++;\n            var fontColor = undefined;\n            if (toCompareStyle.fontColor !== undefined) {\n                fontColor = ('FF' + toCompareStyle.fontColor.replace('#', ''));\n            }\n            result = font.color === fontColor &&\n                font.b === toCompareStyle.bold &&\n                font.i === toCompareStyle.italic &&\n                font.u === toCompareStyle.underline &&\n                font.strike === toCompareStyle.strikeThrough &&\n                font.name === toCompareStyle.fontName &&\n                font.sz === toCompareStyle.fontSize;\n            if (result) {\n                break;\n            }\n        }\n        index = index - 1;\n        return { index: index, result: result };\n    };\n    Workbook.prototype.isNewBorder = function (toCompareStyle) {\n        var bStyle = new CellStyle();\n        if (this.isAllBorder(toCompareStyle.borders)) {\n            return (bStyle.borders.all.color === toCompareStyle.borders.all.color &&\n                bStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle);\n        }\n        else {\n            return (bStyle.borders.left.color === toCompareStyle.borders.left.color &&\n                bStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle &&\n                bStyle.borders.right.color === toCompareStyle.borders.right.color &&\n                bStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle &&\n                bStyle.borders.top.color === toCompareStyle.borders.top.color &&\n                bStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle &&\n                bStyle.borders.bottom.color === toCompareStyle.borders.bottom.color &&\n                bStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle);\n        }\n    };\n    Workbook.prototype.isAllBorder = function (toCompareBorder) {\n        var allBorderStyle = new CellStyle();\n        return allBorderStyle.borders.all.color !== toCompareBorder.all.color &&\n            allBorderStyle.borders.all.lineStyle !== toCompareBorder.all.lineStyle;\n    };\n    Workbook.prototype.compareStyle = function (toCompareStyle) {\n        var result = true;\n        var index = 0;\n        var globalStyleIndex = 0;\n        for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\n            var baseStyle = _a[_i];\n            result = baseStyle.isGlobalStyle ? false : (baseStyle.backColor === toCompareStyle.backColor &&\n                baseStyle.bold === toCompareStyle.bold &&\n                baseStyle.numFmtId === toCompareStyle.numFmtId &&\n                baseStyle.numberFormat === toCompareStyle.numberFormat &&\n                baseStyle.type === toCompareStyle.type &&\n                baseStyle.fontColor === toCompareStyle.fontColor &&\n                baseStyle.fontName === toCompareStyle.fontName &&\n                baseStyle.fontSize === toCompareStyle.fontSize &&\n                baseStyle.hAlign === toCompareStyle.hAlign &&\n                baseStyle.italic === toCompareStyle.italic &&\n                baseStyle.underline === toCompareStyle.underline &&\n                baseStyle.strikeThrough === toCompareStyle.strikeThrough &&\n                baseStyle.vAlign === toCompareStyle.vAlign &&\n                baseStyle.indent === toCompareStyle.indent &&\n                baseStyle.rotation === toCompareStyle.rotation &&\n                baseStyle.wrapText === toCompareStyle.wrapText &&\n                (baseStyle.borders.all.color === toCompareStyle.borders.all.color &&\n                    baseStyle.borders.all.lineStyle === toCompareStyle.borders.all.lineStyle) &&\n                (baseStyle.borders.left.color === toCompareStyle.borders.left.color &&\n                    baseStyle.borders.left.lineStyle === toCompareStyle.borders.left.lineStyle &&\n                    baseStyle.borders.right.color === toCompareStyle.borders.right.color &&\n                    baseStyle.borders.right.lineStyle === toCompareStyle.borders.right.lineStyle &&\n                    baseStyle.borders.top.color === toCompareStyle.borders.top.color &&\n                    baseStyle.borders.top.lineStyle === toCompareStyle.borders.top.lineStyle &&\n                    baseStyle.borders.bottom.color === toCompareStyle.borders.bottom.color &&\n                    baseStyle.borders.bottom.lineStyle === toCompareStyle.borders.bottom.lineStyle));\n            if (result) {\n                index = baseStyle.index;\n                break;\n            }\n        }\n        return { index: index, result: result };\n    };\n    Workbook.prototype.contains = function (array, item) {\n        var index = array.indexOf(item);\n        return index > -1 && index < array.length;\n    };\n    Workbook.prototype.getCellValueType = function (value) {\n        if (value instanceof Date) {\n            return 'datetime';\n        }\n        else if (typeof (value) === 'boolean') {\n            return 'boolean';\n        }\n        else if (typeof (value) === 'number') {\n            return 'number';\n        }\n        else {\n            return 'string';\n        }\n    };\n    Workbook.prototype.parseCellType = function (cell) {\n        var type = cell.type;\n        var saveType;\n        var value = cell.value;\n        switch (type) {\n            case 'datetime':\n                value = this.toOADate(value);\n                if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\n                    if (this.globalStyles.has(cell.cellStyle.name)) {\n                        var value_1 = this.globalStyles.get(cell.cellStyle.name);\n                        this.switchNumberFormat(value_1.format, value_1.type);\n                    }\n                }\n                saveType = 'n';\n                break;\n            //TODO: Update the number format index and style\n            case 'boolean':\n                value = value ? 1 : 0;\n                saveType = 'b';\n                break;\n            case 'number':\n                saveType = 'n';\n                if (cell.cellStyle !== undefined && cell.cellStyle.name !== undefined) {\n                    if (this.globalStyles.has(cell.cellStyle.name)) {\n                        this.switchNumberFormat(this.globalStyles.get(cell.cellStyle.name).format, 'number');\n                    }\n                }\n                break;\n            case 'string':\n                this.sharedStringCount++;\n                saveType = 's';\n                var sstvalue = this.processCellValue(value, cell);\n                if (!this.contains(this.sharedString, sstvalue)) {\n                    this.sharedString.push(sstvalue);\n                }\n                value = this.sharedString.indexOf(sstvalue);\n                break;\n            default:\n                break;\n        }\n        cell.saveType = saveType;\n        cell.value = value;\n    };\n    Workbook.prototype.parserImages = function (json, sheet) {\n        var imagesLength = json.length;\n        sheet.images = [];\n        var imageId = 0;\n        for (var p = 0; p < imagesLength; p++) {\n            var image = this.parserImage(json[p]);\n            sheet.images.push(image);\n        }\n    };\n    Workbook.prototype.parseFilters = function (json, sheet) {\n        sheet.autoFilters = new AutoFilters();\n        if (json.row !== null && json.row !== undefined)\n            sheet.autoFilters.row = json.row;\n        else\n            throw new Error('Argument Null Exception: row null or empty');\n        if (json.lastRow !== null && json.lastRow !== undefined)\n            sheet.autoFilters.lastRow = json.lastRow;\n        else\n            throw new Error('Argument Null Exception: lastRow cannot be null or empty');\n        if (json.column !== null && json.column !== undefined)\n            sheet.autoFilters.column = json.column;\n        else\n            throw new Error('Argument Null Exception: column cannot be null or empty');\n        if (json.lastColumn !== null && json.row !== undefined)\n            sheet.autoFilters.lastColumn = json.lastColumn;\n        else\n            throw new Error('Argument Null Exception: lastColumn cannot be null or empty');\n    };\n    Workbook.prototype.parserImage = function (json) {\n        var image = new Image();\n        if (json.image !== null && json.image !== undefined) {\n            image.image = json.image;\n        }\n        if (json.row !== null && json.row !== undefined) {\n            image.row = json.row;\n        }\n        if (json.column !== null && json.column !== undefined) {\n            image.column = json.column;\n        }\n        if (json.lastRow !== null && json.lastRow !== undefined) {\n            image.lastRow = json.lastRow;\n        }\n        if (json.lastColumn !== null && json.lastColumn !== undefined) {\n            image.lastColumn = json.lastColumn;\n        }\n        if (json.width !== null && json.width !== undefined) {\n            image.width = json.width;\n        }\n        if (json.height !== null && json.height !== undefined) {\n            image.height = json.height;\n        }\n        if (json.horizontalFlip !== null && json.horizontalFlip !== undefined) {\n            image.horizontalFlip = json.horizontalFlip;\n        }\n        if (json.verticalFlip !== null && json.verticalFlip !== undefined) {\n            image.verticalFlip = json.verticalFlip;\n        }\n        if (json.rotation !== null && json.rotation !== undefined) {\n            image.rotation = json.rotation;\n        }\n        return image;\n    };\n    /**\n     * Returns a Promise with a Blob based on the specified BlobSaveType and optional encoding.\n     * @param {BlobSaveType} blobSaveType - A string indicating the type of Blob to generate ('text/csv' or other).\n     * @param {string} [encodingType] - The supported encoding types are \"ansi\", \"unicode\" and \"utf8\".\n     */\n    /* tslint:disable:no-any */\n    Workbook.prototype.saveAsBlob = function (blobSaveType, encodingType) {\n        var _this = this;\n        switch (blobSaveType) {\n            case 'text/csv':\n                return new Promise(function (resolve, reject) {\n                    var obj = {};\n                    obj.blobData = _this.csvHelper.saveAsBlob(encodingType);\n                    resolve(obj);\n                });\n            default:\n                return new Promise(function (resolve, reject) {\n                    _this.saveInternal();\n                    _this.mArchive.saveAsBlob().then(function (blob) {\n                        var obj = {};\n                        obj.blobData = new Blob([blob], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n                        resolve(obj);\n                    });\n                });\n        }\n    };\n    Workbook.prototype.save = function (fileName, proxyUrl) {\n        var _this = this;\n        if (fileName === null || fileName === undefined || fileName === '') {\n            throw new Error('Argument Null Exception: fileName cannot be null or empty');\n        }\n        var xlsxMatch = fileName.match('.xlsx$');\n        var csvMatch = fileName.match('.csv$');\n        if (xlsxMatch !== null && xlsxMatch[0] === ('.' + this.mSaveType)) {\n            this.saveInternal();\n            this.mArchive.save(fileName).then(function () {\n                _this.mArchive.destroy();\n            });\n        }\n        else if (csvMatch !== null && csvMatch[0] === ('.' + this.mSaveType)) {\n            this.csvHelper.save(fileName);\n        }\n        else {\n            throw Error('Save type and file extension is different.');\n        }\n    };\n    Workbook.prototype.saveInternal = function () {\n        this.saveWorkbook();\n        this.saveWorksheets();\n        this.saveSharedString();\n        this.saveStyles();\n        this.saveApp(this.builtInProperties);\n        this.saveCore(this.builtInProperties);\n        this.saveContentType();\n        this.saveTopLevelRelation();\n        this.saveWorkbookRelation();\n    };\n    Workbook.prototype.saveWorkbook = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var workbookTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><workbook xmlns:r = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns= \"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><workbookPr codeName=\"ThisWorkbook\" defaultThemeVersion= \"153222\"/><bookViews><workbookView activeTab=\"0\"/></bookViews>';\n        var sheets = '<sheets>';\n        var length = this.worksheets.length;\n        for (var i = 0; i < length; i++) {\n            /* tslint:disable-next-line:max-line-length */\n            var sheetName = this.worksheets[i].name;\n            sheetName = sheetName.replace(\"&\", \"&amp;\");\n            sheetName = sheetName.replace(\"<\", \"&lt;\");\n            sheetName = sheetName.replace(\">\", \"&gt;\");\n            sheetName = sheetName.replace(\"\\\"\", \"&quot;\");\n            sheets += '<sheet name=\"' + sheetName + '\" sheetId=\"' + (i + 1).toString() + '\" r:id =\"rId' + (i + 1).toString() + '\" />';\n        }\n        sheets += '</sheets>';\n        workbookTemp += sheets;\n        if (this.printTitles.size > 0) {\n            var printTitle_1 = '<definedNames>';\n            this.printTitles.forEach(function (value, key) {\n                printTitle_1 += '<definedName name=\"_xlnm.Print_Titles\" localSheetId=\"' + key + '\">' + value + '</definedName>';\n            });\n            printTitle_1 += '</definedNames>';\n            workbookTemp += printTitle_1;\n        }\n        this.addToArchive(workbookTemp + '</workbook>', 'xl/workbook.xml');\n    };\n    Workbook.prototype.saveWorksheets = function () {\n        var length = this.worksheets.length;\n        for (var i = 0; i < length; i++) {\n            this.saveWorksheet(this.worksheets[i], i);\n        }\n    };\n    Workbook.prototype.saveWorksheet = function (sheet, index) {\n        var sheetBlob = new BlobHelper();\n        /* tslint:disable-next-line:max-line-length */\n        var sheetString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><worksheet xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" xmlns:x14=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main\" xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n        if (!sheet.isSummaryRowBelow) {\n            sheetString += ('<sheetPr>' + '<outlinePr ' + 'summaryBelow=\"0\" >' + '</outlinePr>' + '</sheetPr>');\n        }\n        else {\n            sheetString += ('<sheetPr />');\n        }\n        sheetString += this.saveSheetView(sheet);\n        if (sheet.columns !== undefined) {\n            var colString = '<cols>';\n            for (var _i = 0, _a = sheet.columns; _i < _a.length; _i++) {\n                var column = _a[_i];\n                /* tslint:disable-next-line:max-line-length */\n                if (column.width !== undefined) {\n                    colString += '<col min=\"' + (column.index) + '\" max=\"' + (column.index) + '\" width=\"' + this.pixelsToColumnWidth(column.width) + '\" customWidth=\"1\" />';\n                }\n                else {\n                    colString += '<col min=\"' + (column.index) + '\" max=\"' + (column.index) + '\" width=\"' + '8.43' + '\" customWidth=\"1\" />';\n                }\n            }\n            sheetString += (colString + '</cols>');\n        }\n        sheetString += ('<sheetData>');\n        sheetBlob.append(sheetString);\n        sheetString = '';\n        if (sheet.rows !== undefined) {\n            for (var _b = 0, _c = sheet.rows; _b < _c.length; _b++) {\n                var row = _c[_b];\n                var rowString = '<row r=\"' + (row.index) + '\" ';\n                if (!isNullOrUndefined(row.spans)) {\n                    rowString += 'spans=\"' + row.spans + '\" ';\n                }\n                if (row.height !== undefined) {\n                    rowString += ('ht=\"' + this.pixelsToRowHeight(row.height) + '\" customHeight=\"1\" ');\n                }\n                if (row.grouping !== undefined) {\n                    if (row.grouping.isHidden) {\n                        rowString += ('hidden=\"1\" ');\n                    }\n                    if (row.grouping.outlineLevel !== undefined) {\n                        rowString += ('outlineLevel=\"' + row.grouping.outlineLevel + '\" ');\n                    }\n                    if (row.grouping.isCollapsed) {\n                        rowString += ('collapsed=\"1\" ');\n                    }\n                }\n                rowString += ('>');\n                for (var _d = 0, _e = row.cells; _d < _e.length; _d++) {\n                    var cell = _e[_d];\n                    if (cell !== undefined && (cell.value !== undefined || cell.cellStyle !== undefined)) {\n                        rowString += ('<c r=\"' + cell.refName + '\" ');\n                        if (cell.saveType !== undefined) {\n                            rowString += ('t=\"' + cell.saveType + '\" ');\n                        }\n                        if (cell.styleIndex !== undefined) {\n                            rowString += ('s=\"' + cell.styleIndex + '\" ');\n                        }\n                        rowString += (' >');\n                        if (cell.formula !== undefined) {\n                            rowString += ('<f>' + cell.formula + '</f>');\n                        }\n                        if (cell.value !== undefined) {\n                            rowString += ('<v>' + cell.value + '</v></c>');\n                        }\n                        else {\n                            rowString += ('</c>');\n                        }\n                    }\n                }\n                rowString += ('</row>');\n                sheetBlob.append(rowString);\n            }\n        }\n        sheetString += ('</sheetData>');\n        /* tslint:disable-next-line:max-line-length */\n        if (sheet.autoFilters !== null && sheet.autoFilters !== undefined)\n            sheetString += ('<autoFilter ref=\"' + this.getCellName(sheet.autoFilters.row, sheet.autoFilters.column) + ':' + this.getCellName(sheet.autoFilters.lastRow, sheet.autoFilters.lastColumn) + '\"/>');\n        if (sheet.mergeCells.length > 0) {\n            sheetString += ('<mergeCells count=\"' + sheet.mergeCells.length + '\">');\n            for (var _f = 0, _g = sheet.mergeCells; _f < _g.length; _f++) {\n                var mCell = _g[_f];\n                sheetString += ('<mergeCell ref=\"' + mCell.ref + '\" />');\n            }\n            sheetString += ('</mergeCells>');\n        }\n        if (sheet.hyperLinks.length > 0) {\n            sheetString += ('<hyperlinks>');\n            for (var _h = 0, _j = sheet.hyperLinks; _h < _j.length; _h++) {\n                var hLink = _j[_h];\n                sheetString += ('<hyperlink ref=\"' + hLink.ref + '\" r:id=\"rId' + hLink.rId + '\" />');\n            }\n            sheetString += ('</hyperlinks>');\n        }\n        /* tslint:disable-next-line:max-line-length */\n        sheetString += ('<pageMargins left=\"0.75\" right=\"0.75\" top=\"1\" bottom=\"1\" header=\"0.5\" footer=\"0.5\" /><headerFooter scaleWithDoc=\"1\" alignWithMargins=\"0\" differentFirst=\"0\" differentOddEven=\"0\" />');\n        if (sheet.images != undefined && sheet.images.length > 0) {\n            this.drawingCount++;\n            this.saveDrawings(sheet, sheet.index);\n            sheetString += '<drawing r:id=\"rId' + (sheet.hyperLinks.length + 1) + '\"/>';\n        }\n        this.addToArchive(this.saveSheetRelations(sheet), ('xl/worksheets/_rels/sheet' + sheet.index + '.xml.rels'));\n        sheetBlob.append(sheetString + '</worksheet>');\n        this.addToArchive(sheetBlob.getBlob(), 'xl/worksheets' + '/sheet' + (index + 1) + '.xml');\n    };\n    Workbook.prototype.saveDrawings = function (sheet, index) {\n        var drawings = new BlobHelper();\n        /* tslint:disable-next-line:max-line-length */\n        var sheetDrawingString = '<xdr:wsDr xmlns:xdr=\"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing\" xmlns:a=\"http://schemas.openxmlformats.org/drawingml/2006/main\">';\n        if (sheet.images !== undefined) {\n            var imgId = 0;\n            for (var _i = 0, _a = sheet.images; _i < _a.length; _i++) {\n                var pic = _a[_i];\n                if (pic.height !== undefined && pic.width !== undefined) {\n                    this.updatelastRowOffset(sheet, pic);\n                    this.updatelastColumnOffSet(sheet, pic);\n                    pic.lastRow -= 1;\n                    pic.lastColumn -= 1;\n                }\n                else if (pic.lastRow !== undefined && pic.lastColumn !== undefined) {\n                    pic.lastRowOffset = 0;\n                    pic.lastColOffset = 0;\n                }\n                imgId++;\n                sheetDrawingString += '<xdr:twoCellAnchor editAs=\"oneCell\">';\n                sheetDrawingString += '<xdr:from><xdr:col>';\n                //col\n                sheetDrawingString += pic.column - 1;\n                sheetDrawingString += '</xdr:col><xdr:colOff>';\n                //colOff\n                sheetDrawingString += 0;\n                sheetDrawingString += '</xdr:colOff><xdr:row>';\n                //row\n                sheetDrawingString += pic.row - 1;\n                sheetDrawingString += '</xdr:row><xdr:rowOff>';\n                //rowOff\n                sheetDrawingString += 0;\n                sheetDrawingString += '</xdr:rowOff></xdr:from>';\n                sheetDrawingString += '<xdr:to><xdr:col>';\n                //col\n                sheetDrawingString += pic.lastColumn;\n                sheetDrawingString += '</xdr:col><xdr:colOff>';\n                //colOff\n                sheetDrawingString += pic.lastColOffset;\n                sheetDrawingString += '</xdr:colOff><xdr:row>';\n                //row\n                sheetDrawingString += pic.lastRow;\n                sheetDrawingString += '</xdr:row><xdr:rowOff>';\n                //rowOff\n                sheetDrawingString += pic.lastRowOffset;\n                sheetDrawingString += '</xdr:rowOff></xdr:to>';\n                sheetDrawingString += '<xdr:pic>';\n                sheetDrawingString += '<xdr:nvPicPr>';\n                sheetDrawingString += '<xdr:cNvPr id=\"' + imgId + '\" name=\"Picture ' + imgId + '\"> </xdr:cNvPr>';\n                sheetDrawingString += '<xdr:cNvPicPr><a:picLocks noChangeAspect=\"1\"/></xdr:cNvPicPr> </xdr:nvPicPr>';\n                sheetDrawingString += '<xdr:blipFill>';\n                /* tslint:disable-next-line:max-line-length */\n                sheetDrawingString += '<a:blip xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\" r:embed=\"rId' + imgId + '\" cstate=\"print\">';\n                sheetDrawingString += '</a:blip><a:stretch><a:fillRect /></a:stretch></xdr:blipFill>';\n                sheetDrawingString += '<xdr:spPr>';\n                sheetDrawingString += '<a:xfrm';\n                if (pic.rotation != undefined && pic.rotation <= 3600 && pic.rotation >= -3600) {\n                    sheetDrawingString += ' rot=\"' + (pic.rotation * 60000) + '\"';\n                }\n                if (pic.verticalFlip != undefined && pic.verticalFlip != false) {\n                    sheetDrawingString += ' flipV=\"1\"';\n                }\n                if (pic.horizontalFlip != undefined && pic.horizontalFlip != false) {\n                    sheetDrawingString += ' flipH=\"1\"';\n                }\n                sheetDrawingString += '/>';\n                sheetDrawingString += '<a:prstGeom prst=\"rect\"><a:avLst /></a:prstGeom></xdr:spPr>';\n                sheetDrawingString += '</xdr:pic><xdr:clientData /></xdr:twoCellAnchor>';\n                var imageFile = new BlobHelper();\n                var imageData = this.convertBase64toImage(pic.image);\n                this.imageCount += 1;\n                this.addToArchive(imageData, 'xl/media/image' + this.imageCount + '.png');\n            }\n            drawings.append(sheetDrawingString);\n            drawings.append('</xdr:wsDr>');\n            this.saveDrawingRelations(sheet);\n            this.addToArchive(drawings.getBlob(), 'xl/drawings/drawing' + this.drawingCount + '.xml');\n        }\n    };\n    Workbook.prototype.updatelastRowOffset = function (sheet, picture) {\n        var iCurHeight = picture.height;\n        var iCurRow = picture.row;\n        var iCurOffset = 0;\n        while (iCurHeight >= 0) {\n            var iRowHeight = 0;\n            if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined)\n                iRowHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);\n            else\n                iRowHeight = this.convertToPixels(15);\n            var iSpaceInCell = iRowHeight - (iCurOffset * iRowHeight / 256);\n            if (iSpaceInCell > iCurHeight) {\n                picture.lastRow = iCurRow;\n                picture.lastRowOffset = iCurOffset + (iCurHeight * 256 / iRowHeight);\n                var rowHiddenHeight = 0;\n                if (sheet.rows !== undefined && sheet.rows[iCurRow - 1] !== undefined)\n                    rowHiddenHeight = this.convertToPixels(sheet.rows[iCurRow - 1].height === undefined ? 15 : sheet.rows[iCurRow - 1].height);\n                else\n                    rowHiddenHeight = this.convertToPixels(15);\n                picture.lastRowOffset = (rowHiddenHeight * picture.lastRowOffset) / 256;\n                picture.lastRowOffset = Math.round(picture.lastRowOffset / this.unitsProportions[7]);\n                break;\n            }\n            else {\n                iCurHeight -= iSpaceInCell;\n                iCurRow++;\n                iCurOffset = 0;\n            }\n        }\n    };\n    Workbook.prototype.updatelastColumnOffSet = function (sheet, picture) {\n        var iCurWidth = picture.width;\n        var iCurCol = picture.column;\n        var iCurOffset = 0;\n        while (iCurWidth >= 0) {\n            var iColWidth = 0;\n            if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined)\n                iColWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol - 1].width);\n            else\n                iColWidth = this.ColumnWidthToPixels(8.43);\n            var iSpaceInCell = iColWidth - (iCurOffset * iColWidth / 1024);\n            if (iSpaceInCell > iCurWidth) {\n                picture.lastColumn = iCurCol;\n                picture.lastColOffset = iCurOffset + (iCurWidth * 1024 / iColWidth);\n                var colHiddenWidth = 0;\n                if (sheet.columns !== undefined && sheet.columns[iCurCol - 1] !== undefined)\n                    colHiddenWidth = this.ColumnWidthToPixels(sheet.columns[iCurCol - 1].width === undefined ? 8.43 : sheet.columns[iCurCol - 1].width);\n                else\n                    colHiddenWidth = this.ColumnWidthToPixels(8.43);\n                picture.lastColOffset = (colHiddenWidth * picture.lastColOffset) / 1024;\n                picture.lastColOffset = Math.round(picture.lastColOffset / this.unitsProportions[7]);\n                break;\n            }\n            else {\n                iCurWidth -= iSpaceInCell;\n                iCurCol++;\n                iCurOffset = 0;\n            }\n        }\n    };\n    Workbook.prototype.convertToPixels = function (value) {\n        return value * this.unitsProportions[6];\n    };\n    Workbook.prototype.convertBase64toImage = function (img) {\n        var byteStr = window.atob(img);\n        var buffer = new ArrayBuffer(byteStr.length);\n        var data = new Uint8Array(buffer);\n        for (var i = 0; i < byteStr.length; i++) {\n            data[i] = byteStr.charCodeAt(i);\n        }\n        var blob = new Blob([data], { type: 'image/png' });\n        return blob;\n    };\n    Workbook.prototype.saveDrawingRelations = function (sheet) {\n        /* tslint:disable-next-line:max-line-length */\n        var drawingRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n        var length = sheet.images.length;\n        var id = this.imageCount - sheet.images.length;\n        for (var i = 1; i <= length; i++) {\n            id++;\n            /* tslint:disable-next-line:max-line-length */\n            drawingRelation += '<Relationship Id=\"rId' + i + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"../media/image' + id + '.png\" />';\n        }\n        this.addToArchive((drawingRelation + '</Relationships>'), 'xl/drawings/_rels/drawing' + this.drawingCount + '.xml.rels');\n    };\n    Workbook.prototype.pixelsToColumnWidth = function (pixels) {\n        var dDigitWidth = 7;\n        var val = (pixels > dDigitWidth + 5) ?\n            this.trunc((pixels - 5) / dDigitWidth * 100 + 0.5) / 100 :\n            pixels / (dDigitWidth + 5);\n        return (val > 1) ?\n            ((val * dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0 :\n            (val * (dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0;\n    };\n    Workbook.prototype.ColumnWidthToPixels = function (val) {\n        var dDigitWidth = 7;\n        var fileWidth = (val > 1) ?\n            ((val * dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0 :\n            (val * (dDigitWidth + 5) / dDigitWidth * 256.0) / 256.0;\n        return this.trunc(((256 * fileWidth + this.trunc(128 / dDigitWidth)) / 256) * dDigitWidth);\n    };\n    Workbook.prototype.trunc = function (x) {\n        var n = x - x % 1;\n        return n === 0 && (x < 0 || (x === 0 && (1 / x !== 1 / 0))) ? -0 : n;\n    };\n    Workbook.prototype.pixelsToRowHeight = function (pixels) {\n        return (pixels * this.unitsProportions[5] / this.unitsProportions[6]);\n    };\n    Workbook.prototype.saveSheetRelations = function (sheet) {\n        /* tslint:disable-next-line:max-line-length */\n        var relStr = '<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n        for (var _i = 0, _a = sheet.hyperLinks; _i < _a.length; _i++) {\n            var hLink = _a[_i];\n            /* tslint:disable-next-line:max-line-length */\n            relStr += '<Relationship Id=\"rId' + hLink.rId + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink\" Target=\"' + this.processString(hLink.target) + '\" TargetMode=\"External\" />';\n        }\n        if (sheet.images != undefined && sheet.images.length > 0) {\n            /* tslint:disable-next-line:max-line-length */\n            relStr += '<Relationship Id=\"rId' + (sheet.hyperLinks.length + 1) + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing\" Target=\"../drawings/drawing' + this.drawingCount + '.xml\" />';\n        }\n        relStr += '</Relationships>';\n        return relStr;\n    };\n    Workbook.prototype.saveSheetView = function (sheet) {\n        var paneString = '<sheetViews><sheetView workbookViewId=\"0\" ';\n        if (sheet.enableRtl === true) {\n            paneString += 'rightToLeft=\"1\"';\n        }\n        if (sheet.showGridLines === false) {\n            paneString += 'showGridLines=\"0\" >';\n        }\n        else {\n            paneString += '>';\n        }\n        if (sheet.freezePanes !== undefined) {\n            paneString += '<pane state=\"frozen\"' +\n                ' topLeftCell=\"' + sheet.freezePanes.leftCell + '\" ';\n            if (sheet.freezePanes.row !== 0) {\n                paneString += 'ySplit=\"' + sheet.freezePanes.row + '\" ';\n            }\n            if (sheet.freezePanes.column !== 0) {\n                paneString += 'xSplit=\"' + sheet.freezePanes.column + '\" ';\n            }\n            paneString += '/>';\n        }\n        paneString += '</sheetView></sheetViews > ';\n        return paneString;\n    };\n    Workbook.prototype.saveSharedString = function () {\n        var length = this.sharedString.length;\n        if (length > 0) {\n            /* tslint:disable-next-line:max-line-length */\n            var sstStart = '<?xml version=\"1.0\" encoding=\"utf-8\"?><sst uniqueCount=\"' + length + '\" count=\"' + this.sharedStringCount + '\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n            var si = '';\n            for (var i = 0; i < length; i++) {\n                if (this.sharedString[i].indexOf('<r>') !== 0) {\n                    si += '<si><t>';\n                    si += this.processString(this.sharedString[i]);\n                    si += '</t></si>';\n                }\n                else {\n                    si += '<si>';\n                    si += this.sharedString[i];\n                    si += '</si>';\n                }\n            }\n            si += '</sst>';\n            this.addToArchive(sstStart + si, 'xl/sharedStrings.xml');\n        }\n    };\n    Workbook.prototype.processString = function (value) {\n        if (typeof value == \"string\") {\n            if (value.indexOf('&') !== -1) {\n                value = value.replace(/&/g, '&amp;');\n            }\n            if (value.indexOf('<') !== -1) {\n                value = value.replace(/</g, '&lt;');\n            }\n            if (value.indexOf('>') !== -1) {\n                value = value.replace(/>/g, '&gt;');\n            }\n            if (value.indexOf('\\v') !== -1) {\n                value = value.replace(/\\v/g, '_x000B_');\n            }\n        }\n        else if (typeof value == \"object\") {\n            for (var i = 0; i < value.length; i++) {\n                if (value[i].indexOf('&') !== -1) {\n                    value[i] = value[i].replace(/&/g, '&amp;');\n                }\n                if (value[i].indexOf('<') !== -1) {\n                    value[i] = value[i].replace(/</g, '&lt;');\n                }\n                if (value[i].indexOf('>') !== -1) {\n                    value[i] = value[i].replace(/>/g, '&gt;');\n                }\n                if (value[i].indexOf('\\v') !== -1) {\n                    value[i] = value[i].replace(/\\v/g, '_x000B_');\n                }\n            }\n        }\n        return value;\n    };\n    Workbook.prototype.saveStyles = function () {\n        this.updateCellXfsStyleXfs();\n        /* tslint:disable-next-line:max-line-length */\n        var styleTemp = '<?xml version=\"1.0\" encoding=\"utf-8\"?><styleSheet xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\" mc:Ignorable=\"x14ac\" xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\" xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">';\n        styleTemp += this.saveNumberFormats();\n        styleTemp += this.saveFonts();\n        styleTemp += this.saveFills();\n        styleTemp += this.saveBorders();\n        styleTemp += this.saveCellStyleXfs();\n        styleTemp += this.saveCellXfs();\n        styleTemp += this.saveCellStyles();\n        this.addToArchive(styleTemp + '</styleSheet>', 'xl/styles.xml');\n    };\n    Workbook.prototype.updateCellXfsStyleXfs = function () {\n        for (var _i = 0, _a = this.mStyles; _i < _a.length; _i++) {\n            var style = _a[_i];\n            var cellXfs = undefined;\n            if (style.isGlobalStyle) {\n                cellXfs = new CellStyleXfs();\n                cellXfs.xfId = (style.index - 1);\n            }\n            else {\n                cellXfs = new CellXfs();\n                cellXfs.xfId = 0;\n            }\n            //Add font\n            var compareFontResult = this.isNewFont(style);\n            if (!compareFontResult.result) {\n                var font = new Font();\n                font.b = style.bold;\n                font.i = style.italic;\n                font.name = style.fontName;\n                font.sz = style.fontSize;\n                font.u = style.underline;\n                font.strike = style.strikeThrough;\n                font.color = ('FF' + style.fontColor.replace('#', ''));\n                this.mFonts.push(font);\n                cellXfs.fontId = this.mFonts.length - 1;\n            }\n            else {\n                cellXfs.fontId = compareFontResult.index;\n            }\n            //Add fill\n            if (style.backColor !== 'none') {\n                var backColor = 'FF' + style.backColor.replace('#', '');\n                if (this.mFills.has(backColor)) {\n                    var fillId = this.mFills.get(backColor);\n                    cellXfs.fillId = fillId;\n                }\n                else {\n                    var fillId = this.mFills.size + 2;\n                    this.mFills.set(backColor, fillId);\n                    cellXfs.fillId = (fillId);\n                }\n            }\n            else {\n                cellXfs.fillId = 0;\n            }\n            //Add border            \n            if (!this.isNewBorder(style)) {\n                this.mBorders.push(style.borders);\n                cellXfs.borderId = this.mBorders.length;\n            }\n            else {\n                cellXfs.borderId = 0;\n            }\n            //Add Number Format            \n            if (style.numberFormat !== 'GENERAL') {\n                if (this.mNumFmt.has(style.numberFormat)) {\n                    var numFmt = this.mNumFmt.get(style.numberFormat);\n                    cellXfs.numFmtId = numFmt.numFmtId;\n                }\n                else {\n                    var id = this.mNumFmt.size + 164;\n                    this.mNumFmt.set(style.numberFormat, new NumFmt(id, style.numberFormat));\n                    cellXfs.numFmtId = id;\n                }\n            }\n            else {\n                if (style.numberFormat === 'GENERAL' && style.numFmtId === 14) {\n                    cellXfs.numFmtId = 14;\n                }\n                else {\n                    cellXfs.numFmtId = 0;\n                }\n            }\n            //Add alignment            \n            if (!style.isGlobalStyle) {\n                cellXfs.applyAlignment = 1;\n            }\n            cellXfs.alignment = new Alignment();\n            cellXfs.alignment.indent = style.indent;\n            cellXfs.alignment.horizontal = style.hAlign;\n            cellXfs.alignment.vertical = style.vAlign;\n            cellXfs.alignment.wrapText = style.wrapText ? 1 : 0;\n            cellXfs.alignment.rotation = style.rotation;\n            if (style.isGlobalStyle) {\n                this.mCellStyleXfs.push(cellXfs);\n                this.mCellXfs.push(cellXfs);\n            }\n            else {\n                //Add cellxfs\n                this.mCellXfs.push(cellXfs);\n            }\n        }\n    };\n    Workbook.prototype.saveNumberFormats = function () {\n        if (this.mNumFmt.size >= 1) {\n            var numFmtStyle_1 = '<numFmts count=\"' + (this.mNumFmt.size) + '\">';\n            this.mNumFmt.forEach(function (value, key) {\n                numFmtStyle_1 += '<numFmt numFmtId=\"' + value.numFmtId + '\" formatCode=\"' + value.formatCode.replace(/\"/g, '&quot;') + '\" />';\n            });\n            return (numFmtStyle_1 += '</numFmts>');\n        }\n        else {\n            return '';\n        }\n    };\n    Workbook.prototype.saveFonts = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var fontStyle = '<fonts count=\"' + (this.mFonts.length) + '\">';\n        if (this.mFonts.length >= 1) {\n            for (var _i = 0, _a = this.mFonts; _i < _a.length; _i++) {\n                var font = _a[_i];\n                fontStyle += '<font>';\n                if (font.b) {\n                    fontStyle += '<b />';\n                }\n                if (font.i) {\n                    fontStyle += '<i />';\n                }\n                if (font.u) {\n                    fontStyle += '<u />';\n                }\n                if (font.strike) {\n                    fontStyle += '<strike />';\n                }\n                fontStyle += '<sz val=\"' + font.sz + '\" />';\n                fontStyle += '<color rgb=\"' + font.color + '\" />';\n                fontStyle += '<name val=\"' + font.name + '\" /></font>';\n            }\n        }\n        return fontStyle + '</fonts>';\n    };\n    Workbook.prototype.saveFills = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var fillsStyle = '<fills count=\"' + (this.mFills.size + 2) + '\"><fill><patternFill patternType=\"none\"></patternFill></fill><fill><patternFill patternType=\"gray125\"></patternFill></fill>';\n        if (this.mFills.size >= 1) {\n            this.mFills.forEach(function (value, key) {\n                /* tslint:disable-next-line:max-line-length */\n                fillsStyle += '<fill><patternFill patternType=\"solid\"><fgColor rgb=\"' + key + '\" /><bgColor rgb=\"FFFFFFFF\" /></patternFill></fill>';\n            });\n        }\n        return fillsStyle + '</fills>';\n    };\n    Workbook.prototype.saveBorders = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var bordersStyle = '<borders count=\"' + (this.mBorders.length + 1) + '\"><border><left /><right /><top /><bottom /><diagonal /></border>';\n        if (this.mBorders.length >= 1) {\n            for (var _i = 0, _a = this.mBorders; _i < _a.length; _i++) {\n                var borders = _a[_i];\n                if (this.isAllBorder(borders)) {\n                    var color = borders.all.color.replace('#', '');\n                    var lineStyle = borders.all.lineStyle;\n                    /* tslint:disable-next-line:max-line-length */\n                    bordersStyle += '<border><left style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></left><right style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></right><top style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></top><bottom style=\"' + lineStyle + '\"><color rgb=\"FF' + color + '\" /></bottom></border>';\n                }\n                else {\n                    /* tslint:disable-next-line:max-line-length */\n                    bordersStyle += '<border><left style=\"' + borders.left.lineStyle + '\"><color rgb=\"FF' + borders.left.color.replace('#', '') + '\" /></left><right style=\"' + borders.right.lineStyle + '\"><color rgb=\"FF' + borders.right.color.replace('#', '') + '\" /></right><top style=\"' + borders.top.lineStyle + '\"><color rgb=\"FF' + borders.top.color.replace('#', '') + '\" /></top><bottom style=\"' + borders.bottom.lineStyle + '\"><color rgb=\"FF' + borders.bottom.color.replace('#', '') + '\" /></bottom></border>';\n                }\n            }\n        }\n        return bordersStyle + '</borders>';\n    };\n    Workbook.prototype.saveCellStyles = function () {\n        var _this = this;\n        var cellStyleString = '<cellStyles  count=\"' + (this.cellStyles.size) + '\">';\n        this.cellStyles.forEach(function (value, key) {\n            cellStyleString += '<cellStyle name=\"' + key + '\" xfId=\"' + _this.cellStyles.get(key).xfId + '\"';\n            if (key === 'Normal') {\n                cellStyleString += ' builtinId=\"0\"';\n            }\n            cellStyleString += ' />';\n        });\n        return cellStyleString += '</cellStyles>';\n    };\n    Workbook.prototype.saveCellStyleXfs = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var cellXfsStyle = '<cellStyleXfs count=\"' + (this.mCellStyleXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" />';\n        if (this.mCellStyleXfs.length >= 1) {\n            for (var _i = 0, _a = this.mCellStyleXfs; _i < _a.length; _i++) {\n                var cellStyleXf = _a[_i];\n                /* tslint:disable-next-line:max-line-length */\n                cellXfsStyle += '<xf numFmtId=\"' + cellStyleXf.numFmtId + '\" fontId=\"' + cellStyleXf.fontId + '\" fillId=\"' + cellStyleXf.fillId + '\" borderId=\"' + cellStyleXf.borderId + '\" ';\n                if (cellStyleXf.alignment !== undefined) {\n                    cellXfsStyle += '>' + this.saveAlignment(cellStyleXf) + '</xf>';\n                }\n                else {\n                    cellXfsStyle += ' />';\n                }\n            }\n        }\n        return cellXfsStyle + '</cellStyleXfs>';\n    };\n    Workbook.prototype.saveCellXfs = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var cellXfsStyle = '<cellXfs count=\"' + (this.mCellXfs.length + 1) + '\"><xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\" />';\n        if (this.mCellXfs.length >= 1) {\n            for (var _i = 0, _a = this.mCellXfs; _i < _a.length; _i++) {\n                var cellXf = _a[_i];\n                /* tslint:disable-next-line:max-line-length */\n                cellXfsStyle += '<xf numFmtId=\"' + cellXf.numFmtId + '\" fontId=\"' + cellXf.fontId + '\" fillId=\"' + cellXf.fillId + '\" borderId=\"' + cellXf.borderId + '\" xfId=\"' + cellXf.xfId + '\" ';\n                if (cellXf.applyAlignment === 1) {\n                    cellXfsStyle += 'applyAlignment=\"1\"';\n                }\n                cellXfsStyle += '>' + this.saveAlignment(cellXf) + '</xf>';\n            }\n        }\n        return cellXfsStyle + '</cellXfs>';\n    };\n    Workbook.prototype.saveAlignment = function (cellXf) {\n        var alignString = '<alignment ';\n        if (cellXf.alignment.horizontal !== undefined) {\n            alignString += 'horizontal=\"' + cellXf.alignment.horizontal + '\" ';\n        }\n        if (cellXf.alignment.indent !== undefined && cellXf.alignment.indent !== 0) {\n            alignString += 'indent=\"' + cellXf.alignment.indent + '\" ';\n        }\n        else if (cellXf.alignment.rotation !== undefined && cellXf.alignment.rotation !== 0) {\n            alignString += 'textRotation=\"' + cellXf.alignment.rotation + '\" ';\n        }\n        if (cellXf.alignment.vertical !== undefined) {\n            alignString += 'vertical=\"' + cellXf.alignment.vertical + '\" ';\n        }\n        alignString += 'wrapText=\"' + cellXf.alignment.wrapText + '\" />';\n        return alignString;\n    };\n    Workbook.prototype.saveApp = function (builtInProperties) {\n        /* tslint:disable-next-line:max-line-length */\n        var appString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Properties xmlns=\"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties\"><Application>Essential XlsIO</Application>';\n        if (builtInProperties !== undefined) {\n            if (builtInProperties.manager !== undefined) {\n                appString += '<Manager>' + builtInProperties.manager + '</Manager>';\n            }\n            if (builtInProperties.company !== undefined) {\n                appString += '<Company>' + builtInProperties.company + '</Company>';\n            }\n        }\n        this.addToArchive((appString + '</Properties>'), 'docProps/app.xml');\n    };\n    Workbook.prototype.saveCore = function (builtInProperties) {\n        var createdDate = new Date();\n        /* tslint:disable-next-line:max-line-length */\n        var coreString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><cp:coreProperties xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns:dcmitype=\"http://purl.org/dc/dcmitype/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:cp=\"http://schemas.openxmlformats.org/package/2006/metadata/core-properties\">';\n        if (this.builtInProperties !== undefined) {\n            if (builtInProperties.author !== undefined) {\n                coreString += '<dc:creator>' + builtInProperties.author + '</dc:creator>';\n            }\n            if (builtInProperties.subject !== undefined) {\n                coreString += '<dc:subject>' + builtInProperties.subject + '</dc:subject>';\n            }\n            if (builtInProperties.category !== undefined) {\n                coreString += '<cp:category>' + builtInProperties.category + '</cp:category>';\n            }\n            if (builtInProperties.comments !== undefined) {\n                coreString += '<dc:description>' + builtInProperties.comments + '</dc:description>';\n            }\n            if (builtInProperties.title !== undefined) {\n                coreString += '<dc:title>' + builtInProperties.title + '</dc:title>';\n            }\n            if (builtInProperties.tags !== undefined) {\n                coreString += '<cp:keywords>' + builtInProperties.tags + '</cp:keywords>';\n            }\n            if (builtInProperties.status !== undefined) {\n                coreString += '<cp:contentStatus>' + builtInProperties.status + '</cp:contentStatus>';\n            }\n            if (builtInProperties.createdDate !== undefined) {\n                /* tslint:disable-next-line:max-line-length */\n                coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.createdDate.toISOString() + '</dcterms:created>';\n            }\n            else {\n                coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\n            }\n            if (builtInProperties.modifiedDate !== undefined) {\n                /* tslint:disable-next-line:max-line-length */\n                coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + builtInProperties.modifiedDate.toISOString() + '</dcterms:modified>';\n            }\n            else {\n                coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\n            }\n        }\n        else {\n            coreString += '<dcterms:created xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:created>';\n            coreString += '<dcterms:modified xsi:type=\"dcterms:W3CDTF\">' + createdDate.toISOString() + '</dcterms:modified>';\n        }\n        /* tslint:disable-next-line:max-line-length */\n        coreString += '</cp:coreProperties>';\n        this.addToArchive(coreString, 'docProps/core.xml');\n    };\n    Workbook.prototype.saveTopLevelRelation = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var topRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\"><Relationship Id=\"rId1\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\" Target=\"xl/workbook.xml\" /><Relationship Id=\"rId2\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties\" Target=\"docProps/app.xml\" /><Relationship Id=\"rId3\" Type=\"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\" Target=\"docProps/core.xml\" /></Relationships>';\n        this.addToArchive(topRelation, '_rels/.rels');\n    };\n    Workbook.prototype.saveWorkbookRelation = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var wbRelation = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">';\n        var length = this.worksheets.length;\n        var count = 0;\n        for (var i = 0; i < length; i++, count++) {\n            /* tslint:disable-next-line:max-line-length */\n            wbRelation += '<Relationship Id=\"rId' + (i + 1).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet\" Target=\"worksheets/sheet' + (i + 1).toString() + '.xml\" />';\n        }\n        /* tslint:disable-next-line:max-line-length */\n        wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\" Target=\"styles.xml\" />';\n        if (this.sharedStringCount > 0) {\n            /* tslint:disable-next-line:max-line-length */\n            wbRelation += '<Relationship Id=\"rId' + (++count).toString() + '\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings\" Target=\"sharedStrings.xml\" />';\n        }\n        this.addToArchive((wbRelation + '</Relationships>'), 'xl/_rels/workbook.xml.rels');\n    };\n    Workbook.prototype.saveContentType = function () {\n        /* tslint:disable-next-line:max-line-length */\n        var contentTypeString = '<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?><Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\"><Default Extension=\"xml\" ContentType=\"application/xml\" /><Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\" /><Override PartName=\"/xl/styles.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\" /><Override PartName=\"/xl/workbook.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\" /><Override PartName=\"/docProps/app.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.extended-properties+xml\" /><Override PartName=\"/docProps/core.xml\" ContentType=\"application/vnd.openxmlformats-package.core-properties+xml\" />';\n        var sheetsOverride = '';\n        var length = this.worksheets.length;\n        var drawingIndex = 0;\n        for (var i = 0; i < length; i++) {\n            /* tslint:disable-next-line:max-line-length */\n            sheetsOverride += '<Override PartName=\"/xl/worksheets/sheet' + (i + 1).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\" />';\n            if (this.worksheets[i].images != undefined && this.worksheets[i].images.length > 0) {\n                drawingIndex++;\n                /* tslint:disable-next-line:max-line-length */\n                sheetsOverride += '<Override PartName=\"/xl/drawings/drawing' + (drawingIndex).toString() + '.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.drawing+xml\" />';\n            }\n        }\n        if (this.imageCount > 0)\n            sheetsOverride += '<Default Extension=\"png\" ContentType=\"image/png\" />';\n        if (this.sharedStringCount > 0) {\n            /* tslint:disable-next-line:max-line-length */\n            contentTypeString += '<Override PartName=\"/xl/sharedStrings.xml\" ContentType=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml\" />';\n        }\n        this.addToArchive((contentTypeString + sheetsOverride + '</Types>'), '[Content_Types].xml');\n    };\n    Workbook.prototype.addToArchive = function (xmlString, itemName) {\n        if (typeof (xmlString) === 'string') {\n            var blob = new Blob([xmlString], { type: 'text/plain' });\n            var archiveItem = new ZipArchiveItem(blob, itemName);\n            this.mArchive.addItem(archiveItem);\n        }\n        else {\n            var archiveItem = new ZipArchiveItem(xmlString, itemName);\n            this.mArchive.addItem(archiveItem);\n        }\n    };\n    Workbook.prototype.processMergeCells = function (cell, rowIndex, mergeCells) {\n        if (cell.rowSpan !== 0 || cell.colSpan !== 0) {\n            var mCell = new MergeCell();\n            mCell.x = cell.index;\n            mCell.width = cell.colSpan;\n            mCell.y = rowIndex;\n            mCell.height = cell.rowSpan;\n            var startCell = this.getCellName(mCell.y, mCell.x);\n            var endCell = this.getCellName(rowIndex + mCell.height, cell.index + mCell.width);\n            mCell.ref = startCell + ':' + endCell;\n            var mergedCell = mergeCells.add(mCell);\n            var start = { x: mCell.x, y: mCell.y };\n            var end = {\n                x: (cell.index + mCell.width), y: (rowIndex + mCell.height)\n            };\n            this.updatedMergedCellStyles(start, end, cell);\n        }\n        return mergeCells;\n    };\n    Workbook.prototype.updatedMergedCellStyles = function (sCell, eCell, cell) {\n        for (var x = sCell.x; x <= eCell.x; x++) {\n            for (var y = sCell.y; y <= eCell.y; y++) {\n                this.mergedCellsStyle.set(this.getCellName(y, x), { x: x, y: y, styleIndex: cell.styleIndex });\n            }\n        }\n    };\n    /**\n     * Returns the tick count corresponding to the given year, month, and day.\n     * @param year number value of year\n     * @param month number value of month\n     * @param day number value of day\n     */\n    Workbook.prototype.dateToTicks = function (year, month, day) {\n        var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\n        var daysToMonth365 = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];\n        var daysToMonth366 = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];\n        if (year >= 1 && year <= 9999 && month >= 1 && month <= 12) {\n            var days = this.isLeapYear(year) ? daysToMonth366 : daysToMonth365;\n            var y = year - 1;\n            var n = y * 365 + ((y / 4) | 0) - ((y / 100) | 0) + ((y / 400) | 0) + days[month - 1] + day - 1;\n            return n * ticksPerDay;\n        }\n        throw new Error('Not a valid date');\n    };\n    /**\n     * Return the tick count corresponding to the given hour, minute, second.\n     * @param hour number value of hour\n     * @param minute number value if minute\n     * @param second number value of second\n     */\n    Workbook.prototype.timeToTicks = function (hour, minute, second) {\n        if (hour >= 0 && hour < 24 && minute >= 0 && minute < 60 && second >= 0 && second < 60) {\n            var totalSeconds = hour * 3600 + minute * 60 + second;\n            return totalSeconds * 10000 * 1000;\n        }\n        throw new Error('Not valid time');\n    };\n    /**\n     * Checks if given year is a leap year.\n     * @param year Year value.\n     */\n    Workbook.prototype.isLeapYear = function (year) {\n        return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);\n    };\n    /**\n     * Converts `DateTime` to the equivalent OLE Automation date.\n     */\n    Workbook.prototype.toOADate = function (date) {\n        var ticks = 0;\n        /* tslint:disable-next-line:max-line-length */\n        ticks = this.dateToTicks(date.getFullYear(), (date.getMonth() + 1), date.getDate()) + this.timeToTicks(date.getHours(), date.getMinutes(), date.getSeconds());\n        if (ticks === 0) {\n            return 0.0;\n        }\n        var ticksPerDay = 10000 * 1000 * 60 * 60 * 24;\n        var daysTo1899 = (((365 * 4 + 1) * 25 - 1) * 4 + 1) * 4 + ((365 * 4 + 1) * 25 - 1) * 3 - 367;\n        var doubleDateOffset = daysTo1899 * ticksPerDay;\n        var oaDateMinAsTicks = (((365 * 4 + 1) * 25 - 1) - 365) * ticksPerDay;\n        if (ticks < oaDateMinAsTicks) {\n            throw new Error('Arg_OleAutDateInvalid');\n        }\n        var millisPerDay = 1000 * 60 * 60 * 24;\n        return ((ticks - doubleDateOffset) / 10000) / millisPerDay;\n    };\n    return Workbook;\n}());\nexport { Workbook };\n/**\n * BuiltInProperties Class\n * @private\n */\nvar BuiltInProperties = /** @class */ (function () {\n    function BuiltInProperties() {\n    }\n    return BuiltInProperties;\n}());\nexport { BuiltInProperties };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}